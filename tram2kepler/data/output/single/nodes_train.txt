To bypass UAC, BlackCat ransomware may escalate privileges using the ICMLuaUtil COM interface, as well as use the Masquerade PEB method.
The base64 decoded batch file
an embedded URL is launched in the victim’s browser,
can use .NET framework APIs
can be injected to processes
Moreover, all the strings, binaries, and other relevant data within the ViperSoftX DLL also gets decrypted the same way.
Capture screenshots of victims’ system
By deactivating UAC, the ransomware gets elevated privileges without requiring user permission or administrator credentials
information about the database server and the TDS versions used
used various RATs that have keylogging capabilities
downloads a RAR file.
T1005
Duplication of socket with TLS connection
A new file, again with a JPEG extension
change the final payload’s section names,
Process access to LSASS was observed, likely to dump credentials
Not just an infostealer Gopuram backdoor deployed through 3CX supply chain attack
The strings are decrypted in the same algorithm where the data is split into DWORDs and XOR’d against a random key.
del
One of the techniques to conceal the traffic from DNS-based filtering is Domain Fronting.
to disable remote administration restrictions to facilitate lateral movement and privilege escalation activities
The info stealer also collects information on infected hosts
executing PowerShell code as an EncodedCommand
Screenshots are also taken at a configurable interval; the default is once every 30 seconds.
StartDownload, StopDownload.
ReadRegistryValue
execute an IcedID loader with rundll32
retrieves a decoy tax document and VBS script.
it locates a packed and compressed payload
leveraged by a batch file
inject and execute received module in specified process
The operators made a consistent effort to\ndelete these tools and remove any residual forensic artifacts from\ncompromised systems.
documents sent to the printer.
including adding of registry keys
The LockBit ransomware kinda comes for macOS
all the decrypted C2 URLs
involves sideloading DLLs along
Threat actors will look for networks that have internet-facing servers running RDP and then exploit vulnerabilities in those servers
, the GetSubDirectoryFileListRecursive function
and 2638
PowerShell to connect to third-party file sharing\nsites to download an NGROK utility
UAC bypass will be executed via the AppInfo RPC service.
numerous batch (.bat) files on impacted systems
the actors manually disabled Windows Defender via the Graphical User Interface (GUI)
decrypt it
and IP address
The file is then deleted from the disk
As tasklist uses WMI “under the hood,
The batch file
can send information about the compromised host to a hardcoded C2 server.
ipconfig /all
Checks for the existence of the anti-virus products such as AVG and Avast by checking for the DLLs avghookx.dll, avghooka.dll and snxhk.dll
the Tor communication capability
GetSystemTimeAsFileTime Api call
decodes the configuration data and modules.
uses malicious RTF and DOCX attachments to compromise victims.
The Shell.Application object provides methods for working with the Windows shell
To evade detection, the threat actors disabled Windows Defender
the use of RDP by the Threat Actor
Shell\nExecute a specified command via CMD
methodDescriptionUDP_RAWSends UDP packets where the payload is customizable.ICMP_FLOODSupposed to be an ICMP flood, but the packet is built incorrectly.TCP_CUSTOMSends TCP packets where the payload and flags are fully customizable.TCP_SYNSends SYN packets.TCP_ACKSends ACK packets.TCP_SYNACKSends SYN-ACK packets.TCP_XMASChristmas tree attack (all TCP flags are set).
uploads data to the C2 via a HTTP POST request
The backdoor writes captured\nkeystrokes to memory and uploads them to its C2 server
create a reverse shell.
Showing the Transfer of Cobalt Strike Beacons using RDPClip:
download a ZIP file
injected into the winlogon.exe process.
fetches a payload from the embedded URL and loads it.
using a combination of eight common usernames and 130 passwords
control flow obfuscation
Returns the list of object names in the \GLOBAL?? directory.
Used to search for the string "DBPath" in all files within the current directory and its subdirectories
decrypted with RC4 algorithm
UAC bypass implementation
OS version
Password spraying
The corresponding files are collected
PowerShell Script uses Base64 and hexadecimal encoding and XOR-encryption
decrypt TLS traffic,
an IP address that had been identified as participating in password spray
trying to open either of the shortcuts
which is often encoded or encrypted to prevent detection
Creates two registry keys for persistence
XORed with the first 4 bytes of the AES key used to encrypt the message.
performs the injection is contained in an array and is dynamically loaded.
output of ipconfig was sent to one of two addresses
Modify and query the Windows registry
can search through connected file systems and obtain directory listings.
LoadLibraryW loads the module, VirtualAlloc allocates the memory, CreateProcessW created a process, and ZwUnmapViewOfSection is used
The Scheduled Task was named RuntimeBrokerService.exe
Mimikatz
threat actors using Mimikatz in conjunction with coin miner protocols and software.
makes modifications to the Registry.
Operation CMDStealer Financially Motivated Campaign Leverages CMDBased Scripts and LOLBaS for Online Banking Theft in Portugal Peru and Mexico
function and the corresponding library are dynamically loaded at runtime – also known as explicit linking
This module is embedded in the library’s resource section and encrypted with an algorithm similar to RC4
Microsoft Windows Defender AntiVirus Protection disabled
cmd /C
scheduled tasks created for the updater,
some defense evasion batch scripts.
fetching a remote payload
the import address table and relocation table of the newly injected PE.
sending an HTTP POST request
the PID of the process in which the orchestrator is running.
Full path to file and hidden files
executing scripts and commands retrieved from C2 such as ps1, bat, vbs, and exe
used redirectors to redirect C2 traffic between the target organization’s network and the team’s C2 servers.
Those files will still get executed, if the user clicks on run
registers its file with the name onedrivenew under the Run key in order to make it run after the system is rebooted.
The malware then allocates new memory in the newly-created process, writes the executable to it and executes it in a new thread.
to retrieve the malicious payload and download additional resources
used a similar XOR-based algorithm as part of its encryption mechanisms during communication with the C2.
injected themselves into Windows Media Player
side-loading a malicious DLL, libpng13.dll
the ability to run a SOCKS proxy server on the team server.
Upload and execute a well-known (e.g., with a signature) malicious file to a target DC system
use various encryption algorithms to hide payloads and strings.
This uses a mixture of disguising the ASCII as UTF-16 via manipulating the start of the file, as well as obfuscating the data using a simple cypher.
Spearphishing emails with malicious attachments
ranswomare for Windows can self-propagate in the local area network using the legitimate PsExec utility (contained in its body), which creates a temporary system service.
Enduring Credential Stuffing
Once the execution completes, the file is deleted to leave no evidence on the machine.
Threat actor uploaded the fast reverse proxy (FRP) binary
unpacked payload
to download another remote file
for the Ir8 script to decode.
control flow obfuscation snippet
The malware also established persistence on the host with the creation of a registry run key.
This function is\npatched using Microsoft Detours—a publicly available library used for\ninstrumenting Win32\nfunctions—so
The computer name
Attempted to blend in with a file name that matched the system name it resided on
The decrypted shellcode
were initiated from the rundll32.exe process
secure communication through TLS encryption.
adversary was also observed remotely modifying the Windows Registry on remote systems
the injected Rundll32.exe process.
creates a registry key
executed using remote WMI commands
PowerShell Base64 encoded string:\n\nThe -e is short for -EncodedCommand.
malicious shortcuts
executing malware shellcode and batch files
PeekNamedPipe Windows API function
execute a payload via SMB and Windows Service Creation, respectively, on several target Workstations.
with a button, which, when clicked, downloaded a “malicious” ISO file
Adversary ran scheduled tasks for persistence of certain malware samples
Get processor information of the compromised host by executing "SELECT * FROM Win32_Processor"
has encrypted components.
decrypts configuration data as well as decrypts and unpacks the legitimate PsExec utility
Download a file from the C2 server
use brute force password attacks
The HTA file uses curl utility to download
after completing RDP connections to various hosts on the network
Microsoft SharePoint vulnerability CVE-2019-0604 was used to deliver\nweb shells
its contents are decrypted\nusing the HC-128 encryption algorithm
Windows APIs are obfuscated via a hashing function and dynamically resolved in the run-time.
For each directory it traverses
large volumes of files have been stolen from victims' MOVEit transfer systems.
Conducting discovery indirectly via schedule tasks named “Windows Update”
wmic /node
The malware then de-XORs other strings, with the hard-coded key
The decrypted data consists of a 4 byte size
via the shell “echo” commands.
PowerShell Empire’s ReflectivePEInjection script
Embedded files of ISO image
The dropper is installed into a legitimate file path, posing as the legitimate application.
Firewall rules have occasionally been seen being disabled as well.
Commands are used to download and run the Trojan Installer.
obfuscation mechanisms during the compilation process.
The loaded shellcode is a self-decrypting DLL.
gathers basic system information, which it then sends to the C2,
When running the file from the command line,
sending all cab files generated from the stolen transactions to the server
remote desktop protocol (RDP) and secure shell (SSH) accesses
AnyDesk has been the most common legitimate desktop software used to establish an interactive command and control channel, with ConnectWise seen slightly less frequently.
In its resources we can find another PE
dumped from an injection into the SearchIndexer process
the supplied encrypted decoy document.
performs surveillance on the victim’s machine by collecting system information such as hostnames, IPv4 address, operating system version, disk volume information, disk size and anti-virus software information, and gets the system’s default language.
transferred to the C2 server as a zip file.
TLS_SOCKETContinuously sends random payloads on an open TLS socket.
Adversary exploited a web-facing server with application
This executable uses the Windows Native API
Orchestrator is unpacked
The actors were able to proxy
Sending back the result of the command’s execution to the C2 server.
stores collected data in local SQLite databases prior to exfiltration.
Information such as operating system architecture, framework version, operating system version, etc.
which the actor took after logging in to a user’s Microsoft 365 account
wipes all the files and registry keys created by the backdoor
Task manager was then use to reveal the service running on PID 3488,
examples of command lines
Remote access tools used by the attackers may use application layer protocols (HTTP, HTTPS,
resolves the given API hash and retrieves the address of an exported function
employing a combination of outdated Microsoft Office document vulnerabilities
obfuscated Powershell script that runs another Base64 obfuscated layer that finally decodes the .NET payload.
the decrypted config contains two pipe-delimited IP addresses
to run this executable as a Windows Service.
C:\Windows\system32\cmd.exe /C getsystem
the malware calls a decryption function
it communicates to its C&C servers over the MQTT protocol, which is commonly used in internet-of-things (IoT) devices
Base64-encoded strings
archive
exfiltrate files and extract data from specific applications.
methodDescriptionUDP_LEGITSends UDP packets without data
can be configured as a proxy
created in the Startup folder to execute the script.
being the payloads stored in the resources
The attacker must know the time to set it in the scheduled task.
a reverse proxy
injects shellcode into it
rundll32.exe
The authors used several common techniques to obfuscate this process.
Returns the list of network adapter types, IP and MAC addresses assigned to them.
file download/upload
downloading of the next stage.
With this valid admin account, a Cobalt Strike beacon is loaded into memory of patient zero.
injects itself into explorer.exe
has installed and used legitimate tools such as TeamViewer and AnyConnect on targeted systems.
Copying of files across SMB shares
OneNote file contains an embedded HTA  attachment
attackers have been seen using several methods to distribute the wiper through the domain, like: domain Group Policy Object (GPO)
This function scans VM volumes on an ESXi server.
enumerate running processes and send a list of process names and IDs back to the C2
a base64 encoded string is used to specify various parameters
and then decrypts the content
Most PowerShell scripts involved in LockBit 2.0 cases are Base64 encoded.
Explanation of schtask parameters
the code attempts to decrypt the contents
create a new service for persistence.
to steal the victim’s Facebook information and send it back to the C2.
saves its configuration as a registry key.
informationAddSecurityPackage64.dll injects pc.dll into LSASS by deploying pc.dll as a Security Package
used RATs that persist by creating a Run registry key or by creating a copy of the malware in the Startup folder
Lists internal IP addresses
They then used forged credentials to move to multiple hosts across different sites in the environment and eventually gained root access to all workstations connected to the organization’s mobile device management (MDM) server.
the attackers copy tools necessary for deployment to the compromised host.
by sending a specially crafted TCP packet
DLL sideloading
Once deobfuscated,
they inject their main bot into a Windows process, and then inject their other modules into different processes according to the module’s purpose
The team discovered several standard user accounts that have local administrator access to critical servers.
the payload decryption key
The metadata included TA machine’s hostname,
custom decryption algorithm is being applied on the buffer
MAC addresses of network adapters
“The reconnaissance data is exfiltrated to the attacker-controlled server through an HTTP POST request
brute forcing
UPX is an open-source packing algorithm
The batch script
injecting the shellcode into rundll32.exe
The decryption routine shared between the BADCALL for Linux and targeted destructive malware for Windows from 2014
C:\Windows\system32\cmd.exe /C
can be executed via scheduled tasks.
cmd.exe /c
This includes browser session and credential data.
$BASE64 encoded payload
 Gets command from C2 and executes it 
shows the three registry keys used
cyber actors used valid accounts to log into a service specifically designed to accept remote connections, such as telnet, SSH, RDP, and Virtual Network Computing (VNC).
AES-128-CBC for encryption.
cmd"  /c
TLS encrypted data
threat actors are able to masquerade the dropper or installer
deletes the directory with the files causing the errors
run a network recognition process to find the IP address of each of the ATMs
the threat actors again used Get-System to elevate and then dumped LSASS.
Conti Ransomware
Most of the strings are de-XOR’d in a function
C&C server responds with the next stage executable
replacing the human-readable names of functions (such as "CreateMutexW") with a hash value,
decrypts that specific payload code
They then repeated the install of the remote access software package.
wmic
Remote scheduled tasks to launch their customized PowerShell backdoor
The data stored in the BSS section is encoded
Controlling attached camera devices to take pictures of the compromised computer’s surroundings.
DeleteRegistryValue
(base64 encoded with string replacements)
The krbtgt account is a domain default account
obfuscated using Crypto Obfuscator,
calls point to a suspicious API
previously injected into
we found the original email that included a ZIP file attached, which contained an ISO file.
cmd /c
a second, encrypted component, which carries the payload.
logicaldisk get caption,description,drivetype,providername,volumename
processes which threat actors injected into:
C:\Windows\system32\cmd.exe /C
Upload a screen capture
re-encrypted and saved in the same location
be based on an encryption algorithm used previously in
and protocols, such as for Remote Desktop Protocol
T1072
This thread is then used to execute the SMB copy and remote execution
It uses GetSystemDefaultUILanguage and GetUserDefaultUILanguage to
Compressapi
the injector is its ability to load an assembly into an unmanaged process.
the threat actor connected into the victim’s environment via a VPN
The threat actor created new O365 Service Principals to maintain access to victim’s environments
the batch file
then iterates over each volume to find files
decrypted before being written
VirtualProtect changes the permissions of the given virtual address
domain fronting
Victims can be lured into clicking executable content including binaries, scripts or shortcut files masquerading as benign filetypes such as PDFs or folders.
Higaisa or Winnti APT41 backdoors old and new
Using cmd.exe,
Persistence for the downloaded payload is established via the Tendyron value under the Run key HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run.
recursively deletes all files
issuing the following command line
compressed archives
Manipulate processes (list
check if it is connected to the internet by making a request
began with an actor signing into an internal user’s Microsoft 365 account from a VPN
sending new emails with attached xls and zip files.
func_GetUserName()
service was installed in the system
optimizing the brute forcing implementation
Take screenshots
enter this directly in the host OS command shell.
the execution of several functions in the EFI Boot Services Table, namely AllocatePool, CreateEventEx and ExitBootServices
the hooked process creation function clears a possible hook of the  NtQueueAPCThread function and then uses it to create an APC procedure in the new process.
Tax firms targeted by precision malware attacks
the injector process dispatches another APC using NtQueueApcThread to force the remote process to execute NtSetContextThread.
Uses legitimate VPN, RDP, Citrix or VNC credentials to maintain access to an environment.
While other cybercriminals use sideloading to load another non-binary component
attackers placed
Sets various registry values
HTTP C2 Communication
leverages SOCKS5
creates three more Windows shortcut files in the victim’s machine startup folder,
collect system information and steals user information
batch file downloads the PowerShell downloaderThe
it uses the following command to delete the data in PSReadline
Subscriptions consist of three core WMI classes: a Filter, a\nConsumer, and a FilterToConsumerBinding.
is created using the same API call;
the threat actor connected via Remote Desktop to a Domain Controller and copied the DSInternals10 PowerShell module to the system.
sends an HTTP request that will contain the encrypted bot response.
Once the command line arguments are generated
The encryption algorithm\nis HC-128,
a base64-encoded ransom note,
downloader to the compromised device that executes and downloads the primary payload.
The actors used Mimikatz to dump credentials from the OS using a variety of capabilities resident within the tool.
it stores three embedded binaries within the unpacked payload.
injects its main bot into a hollowed instance of svchost.exe
downloader contains an encrypted configuration at the end of the file.
The decoded base 64 content
Obtains the IP address from the ClientIpAddress field
decrypted file contents
using a variety of software packers
leaked the stack pointer and retrieved the this pointer as a static offset from the stack.
it fetched an additional script payload
being invoked by rundll32.exe.
executes another dropped batch file,
or password spraying.
then deletes the files.
the threat actors executed multiple actions in the cloud using two privileged accounts.
one to get information about the machine, such as the operating system version,
phishing emails that were used as lures to deliver the files
registers its file with the name onedrivenew under the Run key
its unpacking routine
encrypted data is then exfiltrated using the below C&C URL
push Polar ransomware to computers and run it,
decodes 0x3E8 bytes with that key
embedded binary files
The Logic Pro X dropper binary is deleted with the /tmp/ bundle
enticing users to click on malicious shortcut files
the threat actors checked running processes on the accessed hosts via taskmanager
Furthermore, since the data to be decrypted is in another file, the routine becomes even more difficult to investigate, as analysts would need the correct pair for decryption.
Disabling this security control
Other commands can be used to retrieve a detailed list of available services and currently running processes.
cmd"  /c
GrandstreamCVE-2020-25223WebAdmin of Sophos SG UTMCVE-2021-42013ApacheCVE-2022-31137Roxy-WICVE-2022-33891Apache SparkZSL-
MAC address
pack the code’s dependencies into the .NET assembly so it can run self-contained.
injects the ProcessWorm if needed.
checks if it is running on a 64-bit system
a beacon injected into a single Rundll32.exe process
Encoded binary payload
performing password spray,
into the shellcode that will decompress and load the Korplug payload.
The Data field may contain RC4-encrypted, Base64-encoded command
When someone tries to double-click these decoy files, Windows (or the application mapped to the relevant filetype) throws an error because the file isn’t the type of file it appears to be
creating an APC (Asynchronous Procedure Call) with the procedure address pointing to the start of the shellcode.
gaining credential access into victim networks by using legitimate, but compromised credentials to access OWA servers, corporate login portals, and victim networks.
by capturing the CredEnumerateA API.
components use registry keys to signal each other.
LAPSUS Recent techniques tactics and procedures
uses the LookupPrivilegeValue and AdjustTokenPrivilege APIs
simply de-XOR the entire binary
generated based on the computer architecture.
Disables the User Account Control (UAC)
acquire a list of the running processes and their loaded modules
cmd /C
host,
observed the RC4 key\nUwOdHsFXjdCOIrjTCfnblwEZ used for RC4 encryption and\ndecryption.
download of a new payload from the attacker’s remote server
In February 2022, the threat actors exploited Log4Shell [T1190] for initial access
retrieves the MachineGuid of the infected system from the SOFTWARE\Microsoft\Cryptography\MachineGuid registry key
the threat actors who perform brute-force attacks on MS SQL Servers.
usage of Mimikatz
by IsWindowVisible function
domain fronting possible by allowing the operators to configure related settings via the malleable C2 profiles
encrypt
implants made their native Windows executables look like legitimate update tools.
The bytes at 25 hardcoded offsets within this stub are replaced with random bytes to hinder shellcode detection.
The unpacked malware
their initial exploitation of vulnerable internet-facing applications,
GPO was leveraged again to register a scheduled task used to launch the ransomware payload.
GetTickCount Windows API
injectors
starts by enumerating *.blf files in the default user’s profile\ndirectory
PowerShell script that downloads and executes a dropper
DLL sideloading scenario, the malicious loader (ffmpeg.dll) would replace the clean dependency;
using Command Prompt.
embedded malware:
malicious encoded .ico payload
compressed with GZip prior to encryption
messages are exchanged in the original TCP connection (without TLS encryption).
AtomBombing is a technique that allows malware to inject code while avoiding calling suspicious APIs
keystrokes
checks for a few installed and active antivirus products, namely:\nWindows Defender\nESET
Retrieve process list and process information by running 'SELECT * FROM Win32_Process'
contains just one file:
the malware enumerates the running processes on the system and compiles a list of process names and IDs.
Packed Rorschach loader and injector
when using the HTTPS-enabled options
keylogging every tap
Injects the rootkit to a newly created process by another process and updates the callee via NamedPipe
Commands executed by WMI on new hosts
and again on a server with Administrator privileges.
C:\Windows\system32\cmd.exe /C
the threat actors added AnyDesk to the same server running Tactical RMM, providing an additional means of access prior to the deployment of ransomware.
uses KCP on top of a TCP connection
waits for data collection tasks to complete,
It collects a list of fixed drives but excludes the drive where the %WINDOWS% directory exists.
downloading files from a URL
attached to spearphishing emails
AnyDesk and its installation as a service was used
The attachment, if opened,
obfuscated code
cmd.exe /C
sending spearphishing emails with malicious attachments such as RTF documents created via the Royal Road builder
conceal its true code through either encryption or compression
NetServerEnum to get a list
Files commonly observed transferred via SMB include
sideload the DLL
keystroke capture
different variants of a packer
exfiltrates data over the same channel used for C&C
file that\nshould be hidden in a CLFS file
taskrun. Path and filename of the task to be run
The malware decrypts the configuration data with the RC4 algorithm using an embedded 64-byte key.
Decompiled code of a function used by a FatalRAT
Setup the CDN service to create a new CDN endpoint and redirect traffic to your domain.
attackers used an innocent-looking email to lure victims into opening an attachment.
The hashing function used for import resolving
inject a networking module
scanning IPs specified in the command data to collect additional information about the environment
makes a copy of itself, places it in the “Temp” folder (C:\Users\<user>\AppData\Local\Temp), and changes the name to a known Windows application/process.
Threat actors strive to cause Tax Day headaches
This configuration corresponds to resource 1000 in the initial loader. It defines the address and port for both the exfiltration server (file_server) and the C&C server
to identify any credentials which may be stored in technical documentation
creates a batch file in %WINDOWS%\Temp called registry.bat.
Vulnerability in Essential Addons for Elementor Leads to Mass Infection
can identify the user and groups the user belongs to on a compromised host.
The batch file was executed
domains give attackers the ability to mask malicious traffic as legitimate activity within the company
passes the PE payload to it, which the shellcode then loads and executes.
will be decompressed and decrypted
The user is then prompted to open the single visible shortcut (2) file.
encrypted payload 
dumping their LSASS process
The team used these platforms to create flexible and dynamic redirect servers to send traffic to the team’s Cobalt Strike servers
created a new\nWMI class and added a text property to it in order to store a string\nvalue.
Using shellcode that injects implants into newly created instances of the Service Host process (svchost)
uses .NET Graphics class CopyFromScreen Function()
Encrypts a provided payload
keylogging
decrypting them from Windows registry values
enables the data transfer with URL syntax for protocols such as HTTP/HTTPS
encrypted within the main module’s code.
The threat actor accomplished this by using administrative accounts
deobfuscate the file
cyber actors used valid accounts to log into a service specifically designed to accept remote connections,
Once establishing the RDP connection, they deployed Powertool64.exe,
the HTTP C2 Communication section.
Persistence via Scheduled Task
The batch file contained one line,
the username
The task is used to start an IronPython script
After deobfuscation
tries to make users run malicious .lnk, .chm, and .exe files
the command line dump of the memory:\ncmd /c
uses are compressed and encrypted
Vice Society leverages PrintNightmare in ransomware attacks
bat script:
sensitive data from the victim’s machine.
The decryption of the cookies
steals credentials from LSASS
downloads the PowerShell downloader script from an attacker-controlled server
the ‘mimikatz’ string in the Netlogon event that is used by the Mimikatz Zerologon implementation.
decrypt
encrypts the collected information using RC4 encryption with the key “xkYgv127” and encodes it using base64.
The malware can deliver payloads from the command and control (C2) server
using the command line
the hacker also injects malicious DLLs into the memory,
Upon clicking the Open button, it drops the HTA file
Executable that accepts an executable as an argument and executes it with hidden console
encryption
padding the contents with benign data
can collect files from local drives.
GPG decryption
obfuscated information,
The malware decompresses its resource named
the download of wed.hta
features multiple flags that could be set as command line arguments
can see the named pipe created that we specified on the Cobalt Strike interface when we created the SMB listener.
C:\Windows\system32\cmd.exe /C
In other cases, the adversary moved laterally to another system with a domain admin logged in.
which will then send the results to the C2 server
This function obtains the username,
file injection capability
side-loads malicious WDLocal.dll The side-loaded DLL
RPCConnector and RPCBindConnector
fileless and executed only in memory after going through several decryptions and decompression routines
cyber actors were observed Base64 encoding files and command strings to evade security measures.
hashed with MD5
performs the functions of LoadLibrary and calls the loaded module’s startModule export.
the Windows task XML
it also tries to delete the wp-sale.js file
support for TCP network streams (both IPv4 and IPv6),
backdoor source code is embedded as an encrypted\nstring.
attackers also exploited vulnerabilities such as PrintNightmare to escalate privileges
an encrypted Dump.bin file
After decoding,
Cobalt Strike beacons accessing LSASS on multiple occasions, on almost every compromised host.
Download and run
same sequence of opcodes to obfuscate the program’s flow
After injecting into various processes on the host,
It does so by copying the PE headers and each section according to the current executable’s base address.
being able to use the .NET framework APIs directly from Python.
Allows severe/high/moderate/low-level threats to execute
Returns information about the computer system
the different processes they injected into
Contains code to decrypt strings and domains
Once decrypted,
side loading “ffmpeg.dll”.
including the use of DLL sideloading
threat actor(s) made sure to add more paths and folders to Windows Defender exclusion including %TEMP% and C:\Windows\* as well as adding .ps1 (PowerShell) extension to the exclusion list.
After successfully decrypting the C2 URLs
the decrypted payload address
During these RDP sessions,
obtains the victim’s username.
simple stager download of an .exe file and its execution.
TeamViewer
Transparent Tribe APT36  PakistanAligned Threat Actor Expands Interest in Indian Education Sector
This is accomplished with a native bootstrapper DLL, which gets injected into the remote process and prepares it so a .NET assembly can be injected afterwards.
move through the victim environment via RDP
HTTP variant
T1210
This includes bidirectional file transfers between the C&C and the compromised machine.
Decoding Function
additional XOR encryption with the key
download a malicious file
advapi32.CryptEncrypt
and obfuscation mechanisms.
the malware decrypts\neach block using HC-128
a version of the malware that was injected into a victim’s system
AA20258A Chinese Ministry of State SecurityAffiliated Cyber Threat Actor Activity
the attacker’s BAT file to run
added an exclusion rule to Windows Defender
full-blown PE injection tools able to load a native x86/64 payload reflectively into a remote process.
process injection
employs dynamic API resolving to conceal its API imports
the exfiltration of data on the system, such as OS, Processor (architecture),
C:\Windows\system32\cmd.exe /C
the threat actor started their first lateral movement using RDP to pivot to a server using the local Administrator account.
send phishing emails with malicious HTML attachments to all addresses in the victim’s mailbox.
an obfuscated VBA macro
Base64-decodes
deliver more malware,
used this\naccess to deploy and remotely execute FOCUSFJORD on their primary target.
Tracking Traces of Malware Disguised as Hancom Office Document File and Being Distributed RedEyes
exfiltrate data from messaging applications such as WhatsApp and Viber
Shellcode which is used for code injection
the threat actor’s RDP session.
encrypted with a different, single byte XOR key
Software vulnerabilities, such as PrintNightmare (CVE-2021-1675) and (CVE-2021-34527), may be exploited in an attempt to elevate privileges.
drop batch files
malware dynamically calls the API NtAllocateVirtualMemory
Showing the Transfer of Cobalt Strike Beacons using RDPClip:
had been archived
Reverse proxy tool
The decrypted data
Once the user had mounted the ISO and the LNK file was executed by the user, the complex execution flow started.
encrypted PowerShell.
the injection process
The backdoor periodically checks and creates its own persistence by making sure that Step 1 of the loader is run every time the system is started, via a registry Run value, in the same way as in the installer:\nHKCU\Software\Microsoft\Windows\CurrentVersion\Run\<random_run_name>\”%appdata%\Python27({32|64})\pythonw.exe” “<loader_step_1>” “<loader_encrypted_step_2>”
reg.exe ADD\n'HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server' /v\nfSingleSessionPerUser /t REG_DWORD /d 0 /f
The actors added an exclusion rule to Windows Defender.
creates a registry key in HKEY_CURRENT_USER\SOFTWARE\
force a group policy update
contains the decryption algorithm for the second stage
From there, the threat actors began connecting to other hosts via RDP, including the a backup server.
decodes the base64-encoded strings and initializes them
malware aims to deactivate User Account Control (UAC) on the target system
the injected code
using the default factory credentials.
actors used a legitimate admin account to remotely log on to the domain controller
In some cases, they are then re-encrypted but with a different key
The malware implemented a series of Mimikatz modifications on closed-source tooling
On one machine, we found that the malware injected itself, using process hollowing, into ielowutil.exe
Delete the dropper executable
Obfuscation is one of the most popular methods to achieve this.
loading the final payload (PE file) from the third of the encrypted files.
attacker also attempted to execute PowerShell scripts on remote systems in the environment while moving system-to-system
credential-based deception is to stage the deceptive credentials in LSASS process memory.
Another component collects information about mapped volumes, including mount point, name, drive type, and disk usage data.
As a second argument, the macro passes the entry function “DllUnregisterServer” to rundll32.exe so that the execution starts correctly.
The process injection technique was used multiple times to inject into different processes
may also deliver a weaponized Office document that executes the ReconShark reconnaissance malware.
Process Hashes and Process Privilege Checks
send a list of process names and IDs back to the C2
embeds the next stages of the execution inside an additional file, usually an XML or a PDF file.
Cobalt Strike was used to enable RDP,
the threat actors often opened Internet Explorer to download their beacons
its C2 server via a\nsubsequent HTTP POST request.
PDF documents with a CV and IELTS certificate
Using compromised credentials to access corporate VPNs.
using the username
copies itself to the Startup folder
New Horabot campaign targets the Americas
The low-level functions, directly related with performing the injection, are called via raw syscalls
adds an additional layer of obfuscation to the code
have attempted to get users to execute malicious files masquerading as documents
user opens the CMD file,
wmic  /node
creating SQL queries to produce the database tables to store the stolen data
IPv4 addresses
used various RATs that can access the local file system and upload, download or delete files
The team used domain fronting [T1090.004] to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating
GoBruteforcer GolangBased Botnet Actively Harvests Web Servers
the malware to unpack
URL registered in the task scheduler
obtain logs of the infected machine’s keystrokes
the adversary attempting to exfiltrate sensitive information over SMB (TCP/445) directly from a compromised domain controller.
indicating that the user deleted the collected data.
it will install a fake Windows service called “windowsupdate”
the threat actors conducted further discovery tasks running find.bat and p.bat,
T1090
 NtQueueAPCThread function
Returns the current user’s SID.
running native Windows commands on compromised servers,
the payload that is decoded using the first byte as a key,
C:\Windows\system32\cmd.exe /C mimikatz.exe privilege::debug sekurlsa::logonPasswords full samdump
fetches IcedID from a remote resource
Screen Capture
uses local caches to stage data
C:\Windows\system32\cmd.exe /C
additional beacons executed using remote WMIC commands,
checking for security products
Named pipes were created in order to establish communication between CS processes
recently opened documents
backdoor with the ability to download and run additional tools
the threat actors proceeded to RDP to the domain controller.
by listing accessible local IPs
target for DLL side-loading
the Windows Command Processor was used
OS Version
The public-facing application compromise approach
uses both regular and reflective DLL injection.
Many of the hosts used to support these second-stage operations hosted RDP services
usually compile all necessary libraries in a single binary, making malware classification more difficult for analysts and resulting in a large binary
registers two scheduled tasks:
Write in the registry
The last registry key was used to store additional PowerShell code.
use some victims as proxies, or some vulnerable devices to forward communication to their real C&C servers.
malicious payload
registry key where each embedded resource is to be written
In some instances, they used Windows Management Instrumentation (WMI) Event Subscriptions
loads it using rundll32
GuLoader VBScript Variant Returns with PowerShell Updates
Enumerate files on desktop
the threat actors moved to install AnyDesk on several servers including a backup management host, likely as a further means of persistence or later command and control.
attacker disabling Windows Defender
The executable is prepended with 0x4000 random bytes and encrypted with RC4
The backdoor may also download and execute\nadditional PowerShell commands from its command and control (C2) server.
powershell.exe Uninstall-WindowsFeature -Name Windows-Defender-GUI
Before exfiltration, the attackers may put collected data in 7Zip archives.
Stopping Cisco AMP /  Disabling Microsoft Defender
A scheduled task was created at that time to maintain persistence on this host
They also retrieve networking information, like network adapters, specific machines, and network services like  Remote Desktop Protocol (RDP).
Thread Execution Hijacking
to escalate privileges using valid accounts
used in the code to call the corresponding API function
can self-propagate in the network by using the legitimate PsExec utility
Malware using the AtomBombing technique first writes the payload into the global atom table, which can be accessed by all processes.
Process injection was observed during the intrusion
The HTTP protocol uses the message format detailed in the previous paragraph, but it adds a few extra steps to disguise its traffic as legitimate HTTP
Windows displays a warning message when the user tries to open a file downloaded from the internet.
been obfuscated in order to hide its real intentions
C:\Windows\system32\cmd.exe /C
This is used as an integrity check for the decryption process.
copy each PE section one at a time
loading a fresh copy of “ntdll.dll” from disk to avoid process hollowing detection
use this technique to retrieve export functions from loaded libraries
Downloads a file from the given URL and executes it with the given arguments.
VirtualAlloc used for allocating memory in the current process
decrypt these database passwords,
the system information gathered by Domino Backdoor and sent to the C2
insights on anti-virus software present on the machine
Once the REvil configuration has decrypted
collects cookie information, search histories, and key inputs from browsers
T1218.011
powershell -np -w hidden -encodedcommand
Also the de-XOR’d strings,
sends this information to its C2 server
adversary executes Cobalt Strike’s built-in Mimikatz to dump its password hashes.
executes an embedded batch file.
a technique leveraging the Windows Management Instrumentation (WMI) service to execute malicious code.
used various RATs that can perform remote desktop access.
a malicious actor was observed signing in to a Microsoft 365 account
The decryption function
Disabling Windows event logging in an attempt to evade detection
direct Cobalt Strike processes and the injected processes
the document triggers the injection of a custom downloader – a PE executable – into an iexplore.exe process.
which is injected to conduct backdoor behaviors.
collects browser history and passwords from the following browsers
the encrypted payload
“RClone” was downloaded on the file servers
T1113
VPN access using Single Factor authentication.
The two ".bat" files that were sent
Code for the brute forcing implementation is significantly more structured
executed a spam campaign with malicious OneNote file attachments,
This call instructs LSASS to load and execute pc.dll, which then stages the getHashFlsa64.dll credential theft component.
Decryption shellcode execution flow
wmic
A lookback under the TA410 umbrella Its cyberespionage TTPs and activity
each data byte in the HTTP based C2 communication,
the service account logged into one of the Domain Controllers from the beachhead.
C:\Windows\system32\cmd.exe /C
For lateral movement, the attackers made use of the PsExec tool and the net use command for accessing shared resources on remote machines.
Ngrok – a reverse proxy tool for proxying an internal service out onto an Ngrok domain
Upload a screen capture to its C2\nserver
The following file extensions of interest, specific to media, documents, emails, and certificates,
the malware attempts to retrieve additional malicious artifacts
then iterates over each volume to search for specific files related to virtual machines.
it decrypts the c2 URL
Syncro RMM can also be used as a persistence mechanism
wrote a registry run key for persistence
The driver collects information about installed AV filters
Windows Service Creation
C:\Windows\system32\cmd.exe /C
can execute shell commands
can take away system
batch script
a decompression utility to extract the ransomware
were observed using Microsoft signed binaries, such as Rundll32, as a proxy to execute malicious payloads.
to decrypt the payload
using the MoveFileExW() API function,
is unpacked from the CHM file.
collects information, primarily system information
concealed programs and documents at innocuous-seeming locations on victim networks and in victim networks’ “recycle bins.”
actors may misuse various content delivery networks (CDNs) to set up redirects of serving content to the content served by attacker-controlled C2 hosts.
encoded malware
Captured data stored in the uploader C2
A thread with trampoline shellcode is created inside exe.
deletes the following registry keys:\nHKCR\.EXE\nHKCR\.dll\nHKCR\*
Keylogger database
shows that this connection was likely HTTPS
collecting system information such as hostnames
C:\Windows\System32\cmd.exe /c start rundll32 namr.dll,IternalJob
HTTP variant
Common injection methods used by banking Trojans involve writing a mapped PE into a remote process using WriteProcessMemory
injects shellcode into the processes explorer.exe, winlogon.exe, wmplayer.exe, svchost.exe, and spoolsv.exe
The actors’ exploit payload created Scheduled Task RuntimeBrokerService.exe, which executed RuntimeBroker.exe daily as SYSTEM.
tokens, and passwords from various web browsers and applications
the malware creates a scheduled task to execute its copy from this randomized path:\n\nschtasks /Create /TN 8NaZrCq3pGeDRXKF /SC MINUTE /MO 15 /TR "explorer.exe c:\users\public\8NaZrCq3pGeDRXKF.zip\8NaZr.exe" /f
has a functionality to capture a screenshot of the targeted or compromised host as part of its data collection and exfiltration
regular RAR archives that have an executable file inside.
a single payload\npackage is retrieved that contains both the two-stage shellcode
With some further process injection
steal credentials by decrypting them from registry values.
C:\Windows\system32\cmd.exe
the threat actor used a compromised O365 administrator account
uses wmic to obtain the
From these injected processes,
Routes traffic over TOR and VPN servers to obfuscate their activities.
this technique for encryption-decryption is easily more discernable during analysis because both the encrypted data and the mapping are in the same file
its injection into one of the following processes
WTB Adwind Trojan Circumvents Antivirus Software To Infect Your PC
use of three base64 encoded echo commands
Decoded content
the execution of the downloaded DLL via the tool rundll32.exe.
Delete file
we found a custom AntivirusCheck class, which can check running processes against a hardcoded list of executable filenames from known security products, including ESET products
Then, it creates and sets a new value for the registry key HKCU\Software\Microsoft\Windows\CurrentVersion\Run.
wmic  /node
The actors used Mimikatz to harvest credentials.
which can check running processes
Exploiting Internet accessible webservers using webshell small code injections against multiple code languages, including net, asp, apsx, php, japx, and cfm.
Using this RMM agent they proceeded to install AnyDesk on the host.
the malicious ZIP file is deleted.
List of recently opened files and folders on the computer.
To hide the strings it uses during its execution, it primarily uses a simple encoding by subtracting 35 from each character of the original string and encoding the result with Base64
C&C traffic of the PUBLOAD HTTP variant
inject Remcos RAT into a legitimate Windows process such as ieinstal.exe.
RAR archive is downloaded
C:\Windows\system32\cmd.exe /C
Update 2 3CX users under DLLsideloading attack What you need to know
threat actors obtain initial access to networks is through the use of compromised valid credential pairs
operators delete files such as mim.exe, mim32.exe, zam.exe and zam.bat to cover their tracks
and Remote Desktop user sessions.
a given command line.
PDF file attached
decrypted using the RC4 algorithm with a hardcoded key in the resource.
WMI persistence.
decrypts it
a decrypted configuration
Before a call to CreateWindowEx, you would usually first need to create a class by calling RegisterClass and then class CreateWindowEx.
func_GetFirewalls()
The Blockchain.pdf file is a malicious HTML application file
The embedded DLL
used a registry run key to maintain persistence.
Uses encoded PowerShell commands.
PowerShell downloader script, which the attacker attempts to execute to re-infect the victim’s machine,
information is sent to the C&C, encrypted with a hardcoded key and DES CBC algorithm:
The names of Windows API functions are stored in the first 150 bytes
The common processes observed were two injected processes
PE file was encoded as an obfuscated hexadecimal string.
HTTP by prepending the data with a hardcoded
then launched by cmd.exe
It also uses the command “CopyFromScreen” to capture a screenshot.
ransomware uses obfuscation.
runs it via rundll32.exe
to download and install payloads
T1552.001
download the payloads
cmd /C
masks your traffic to a certain website by masquerading it as a different domain.
decoding
that registers a scheduled task which runs immediately and upon user logon,
encodes it using XOR encoding with key
invokes the following API’s:
Creates benign-looking services for the ransomware binary.
C :\Windows\system32\cmd.exe /C shell
reflective PE injection allows the malware to load and execute its code directly from memory
launched by cmd.exe
the payload most likely arrives by exploiting public-facing websites and domains.
Get AdapterRAM and Graphic Card Name and type by executing  "root\\CIMV2", "SELECT * FROM Win32_VideoController"
and execute the file using CreateProcessA.
executed using the Command-Line Compiler.
executes an executable using process hollowing
RC4-decrypts command data returned in\nthe Data field.
These strings are passed to a decoding function where they are converted from hex to byte and XOR’d with decimal 18.
message to both the Debug server and the Telegram channel,
OS Credential Dumping: LSASS Memory
it collects usernames
malicious actor signing in to a Microsoft 365 account
Disable Windows update services such as (“wuauserv”, “WaaSMedicSvc”, “UsoSvc”)
with batch scripts
cmd.exe /c
Process to inject into
carries out process injections
the threat actor started their first lateral movement using RDP
copied to the folder %appdata%\Microsoft\AddIns\
support for multiple transport protocols for connecting to C2 servers
T1083
to establish new services to enable persistence.
contains the “whoami” command
the decrypted payload
enumerate files and folders
on TCP port 2222.
scans for these cryptocurrency wallets in local directories:\nArmory\nAtomic Wallet\nBinance\nBitcoin\nBlockstream Green\nCoinomi\nDelta\nElectrum\nExodus\nGuarda\nJaxx Liberty\nLedger Live\nTrezor Bridge
Returns names of shortcuts in the Desktop directory.
is a small, UPX-packed password protected binary
This file was opened during their RDP session and contained the PowerShell commands used to launch a new beacon:
the actors used RDP
Mimikatz, which is a tool used for extracting sensitive information such as passwords and authentication credentials from a Windows operating system.
keylogging,
After choosing a new server and connecting via RDP,
In order to unpack the legitimate binary,
to obfuscate control flow of program.
At first glance, the files within the directory may seem legitimate
decoding
Disables the "administrator in Admin Approval Mode" user type (disables UAC prompts)
will create a key using advapi32.CryptDeriveKey
search, delete files.
stealing multiple types of data
both use CreateFile and WriteFile APIs
"cmd"  /c
a new service that will run its VBS script (4.1) using sc.exe.
that stages execution of further payloads downloaded from the internet
creating a folder named onedrivenew in the AppData directory and self-copying itself with the filename onedrivenew.exe to appear as a normal file.
Local and external IP address
Windows APIs
the lsass.exe beacon
dynamic API resolution
can modify group policy for privilege escalation and defense evasion.
calls Stage 1 again via process hollowing with four parameters
The output of this decryption
RDP is used by the group for lateral movement.
to track which of the 3 processes are running on the system.
Hooks several functions from ntdll.dll to hide its presence.
running a command that extracts a Base64-encoded CAB archive from the body of the LNK file,
establishes persistence by creating an autostart service that allows it to run whenever the machine boots.
TcpBindConnector and HttpBindConnector
by side-loading dr.dll, used by a legitimate, signed binary
the malware immediately begins to look for EDR and antivirus software.
spam email comprising an attached MS Office document
showing the decrypted botpack structure.
Because rundll32.exe executed PowerShell, we can see that rundll32.exe created
It then adds the extensions such as exe and DLL as exclusions to Windows Defender.
Payload decryption function.
These were either dropped directly via the webshell or downloaded from a remote server
the malware can disable the functionalities of EDR/AV products.
Malware Spotlight Camaro Dragons TinyNote Backdoor
gathers the OS version, machine name, CPU type, amount of RAM available from the victim’s machine
decrypts the DLL strings to be used later to resolve handles to the DLLs needed
employ proxychains from the attacker’s Kali Linux host
uses steganography
shellcode control flow obfuscation
the threat actors leveraged RDP for access into the account.
the opening of a URL file extracted from the archive.
The GPG decryption routine
keystrokes
Add the process to a startup registry key
WMI query
credentials are accessed and the target organization has not reset corresponding passwords, the actors can log in with stolen credentials and masquerade as legitimate users,
compromised server that prompts the victim to click
create scheduled tasks for persistence.
KCP protocol
We’ve seen the payload delivered in diverse ways including DLL side-loading,
The Rising Trend of OneNote Documents for Malware delivery
that have Base64 and AES encrypted C2’s appended to them
they accessed the server via RDP
func_GetHostSerialNumber()
reg add HKLM\software\Microsoft\Windows\CurrentVersion\Policies\System
Then, a function defined by its hash is retrieved (using the same hashing algorithm that was used to retrieve imports from normally loaded DLLs):
T1012
a brute-force attack of a Remote Desktop Protocol on a public-facing server.
The actor leveraged ONE-FOX - a collection of pentest tools - to copy binaries from actor´s system to the victim.
to download and execute additional\nPowerShell code and Windows binaries
uses the Microsoft Graph API
the actors leveraged RDP to propagate to several hosts within the network.
Cobalt Strike Beacon was dropped and executed on the system
public facing systems is compromised
sends them back to the server in POST request:
Proxying RDP traffic via a processes such as a Cobalt Strike beacon reduces the exposure of the threat actor’s own infrastructure, and blends RDP activity to those of internal hosts on the network.
The team performed an NTLM-relay attack to obtain the DC’s TGT, followed by a golden ticket attack on a SharePoint server with Unconstrained Delegation to gain the ability to impersonate any Site 1 AD account.
cyber actors have also been observed modifying group policies for password exploitation.
The sample is obfuscated via the Babadeda crypter.
or Windows Scripting
the submitter collected the files from different places
using DeviceControl API methods
The traffic beaconing contains the following pattern that will be encrypted with the AES key extracted from the compressed blob
script removes the i2pd Mach-O file from the disk.
Windows Defender, other anti-malware solutions and monitoring tools are disabled utilizing a process explorer tool,
is a batch script that creates a new user
execution begins with the user clicking on a shortcut file
The threat actors then executed Mimikatz on VDI-KMS to harvest credentials
Uses MsiEnumProductsA and MsiGetProductInfoA APIs.
control flow obfuscation to hinder analysis
executing a launcher utility with the filename System.Mail.Service.dll (MD5: 5F9020983A61446A77AF1976247C443D) through the command line as a service.
execute embedded scripts
cmd /C
decrypt,
The Threat actor also used valid accounts to create persistence within the environment
Get content list from a specified directory
C:\Windows\system32\cmd.exe /C
Uses EnumDeviceDrivers and GetDeviceDriverBaseNameA APIs.
The victim downloads a Trojanized application and executes it.
keylogging,
creates a thread in the kernel that injects the next stage into winlogon.exe.
launching the getsystem command in the wrong console (shell console rather than the beacon console).
To obtain authentication data, the attackers may dump the LSASS process using legitimate tools (procdump, comsvcs.dll).
to decrypt the payload from the .dat file using the AES-256-CTR decryption algorithm and starts to execute.
CreateProcessInternalW creates a new process
basic discovery tasks on the host using built in Windows utilities.
walks through all mapped file systems and collects files
Early Bird Catches the Wormhole Observations from the StellarParticle Campaign
This remote process listing
Code responsible for downloading cron_script file
string encryption,
Comsvcs.dll is a well-known way to extract LSASS (Local Security Authority Subsystem Service) data
writes its configuration to registry,\nthis value is set to “default” and is later manually changed by the\nactor
Application-level protocol
content in a batch script:
the batch file makes the following changes to the system
T1518.001
deletes the intermediate DLL library and encrypted ransomware
decrypted through an AES-256-CBCdecryption algorithm
to connect via SMB to targeted users, and then copy their Chrome profile directories as well as data protection API (DPAPI) data.
steal credentials by decrypting them from registry values
uses Run keys for persistence of its loader
exfiltrates data over its C&C channel.
Threat actors executed this tool on patient 0 with low-level privileges multiple times
Mimikatz – a credential theft tool.
handle to the current process for the purpose of allocating memory with PAGE_EXECUTE_READWRITE permissions
screenshot
disseminate additional phishing emails to the victim’s contacts.
sends it to the C2 server.
pads the resulting Mach-O with a random number of \x00 bytes
to obfuscate their malware.
used HTTPS reverse proxies to redirect C2 traffic
will decrypt this file with a single byte in XOR operations, find the PE header, and drop the payload to the specified path.
reg  add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost"
spawned with PowerShell via Task Scheduler
we can see one more HTTP request
encrypted payload, containing the main functionality of the dropper, is stored in the dropper’s resources as bitmaps named from A to L.
decodes it into shellcode with Base64
The threat actors also expressed interest in other access methods such as RDP
T1033
to perform initial intrusion leveraging exposed vulnerable applications, for example, continuing to exploit Log4j 2 vulnerabilities in unpatched systems in
An obfuscator similar to OLLVM is used to protect FinSpy
In the footsteps of the Fancy Bear PowerPoint mouseover event abused to deliver Graphite implants
the computer name is sent to the C2
use of the same DeviceControl API methods
in return receives an AES encrypted payload.
removes virus definitions and disables all portions of Windows Defender and other common antivirus programs in the system registry
passing the path to the encrypted component as a parameter.
The threat actor was able to RDP to a backup server
executed by the user clicking a shortcut file
module is injected into one of the processes specified by the C&C
Window titles to keylog
the attacker-controlled server through an HTTP POST request
upload data to C&C
the encrypted strings reside within the function
keyloggers
Use a previously compromised domain admin account
The following files are downloaded and written to disk:
consists of two .exe files.
Windows discovery commands
Writing executables to a randomly-selected directory under Program Files, and naming the EXE to match the\nchosen directory name
A new service was created
remove all existing shadow copies via vssadmin on command line
run under the name “tmp.exe” by unpacking itself to the “C:\Users\admin\AppData\Local\Temp\” file path.
the malware needs to read\nand decrypt those registry key values
the malware author used phishing emails to deliver malicious OneNote document either as attachment
encodes the email addresses in the “.Outlook” file to a data stream
proxy
HttpConnector and HttpBindConnector are HTTP client with support for proxy and HTTP server.
New IcedID variants shift from bank fraud to malware delivery
run the scheduled task every 2 minutes is  start.
If a user with administrative access is compromised, an actor can access servers without needing to elevate privileges
accessible through API functions.
systeminfo
KiUserExceptionDispatcher function
Inject malicious code into legitimate processes
"cmd"  /c
The loader injects an orchestrator into memory in a svchost.exe process.
which allowed the threat actor to move freely between domains.
It checks that there are no drivers loaded from security-related software (e.g., groundling32.sys)
The first base64 data blob
An encrypted payload
is executed by the victim
ipconfig
The malicious dropper contains a legitimate version of the software and executes it to give the illusion of a properly behaving application.
conceals memory areas that contain the Trojan components’ code and data.
collects file and directory metadata
The malware started to open up both UDP and TCP ports to connect with a C2 server
then executed via WMI.
is re-encrypted
screenshotting,
decrypts the password for the dba username
executes OSSUTIL (included in the installer package as ssu.exe) to download files
its installation as a service was used in order to persist and create a backdoor to the network.
obfuscated trampoline in the .text section.
the AES 256 decryption key of the payload
Optical Disc Image files (ISO) containing LNK files that had slightly modified PowerShell scripts, and Hangul Word Processor decoy documents
along with code that decodes and decrypts the block of base64.
the user account used to connect to the victim’s O365 tenant
It starts with de-obfuscating the next stage (string replacements + base64 decoding)
This technique, which also leverages CDNs, allows the beacon to appear to connect to third-party domains, such as nytimes.com, when it is actually connecting to the team’s redirect server
It works by decrypting a shellcode BLOB with AES-256
and the PsExec Windows Sysinternals tool and net for lateral movement and exploration
T1016
injecting itself into a running explorer.exe process.
tries to enumerate the current directory
the actor established initial access by compromising the victim’s web server
malicious OneNote documents to entice users to click on an embedded file to download and execute
just C2 communications; until around 3 hours later, Bumblebee dropped a Cobalt Strike beacon
HackTool.Win32.CCPASS is another tool that is also used for Windows 10 UAC bypass
to create a ImmediateTask
Mimikatz is a key player in dumping credentials but LockBit 2.0 has been occasionally seen utilizing MiniDump as well.
Batch files create a new admin user 
0x10000012inject and execute received module in specified process
triggered when the user starts the presentation mode and moves the mouse
The threat actor executed two actions to bypass Windows Defender
This proxy server is located on the I2P network at the destination of the pool tunnel
for the infected system by gathering the username and hostname
keyboard layout
enumerates all running processes
Iron Tigers SysUpdate Reappears Adds Linux Targeting
abused to side-load
four scheduled tasks are created:
deobfuscated code of GuLoader’s shellcode.
the threat actor became active by initiating a proxied RDP connection via the Cobalt Strike beacon to the domain controller.
decryption routine is executed that decrypts the remaining malicious code in the .kxrt section and writes it to the virtual memory.
they will be able to download the decryptor
decrypt
By modifying the below registry value EnableLUA to “0”
OpenSource Gh0st RAT Still Haunting Inboxes 15 Years After Release
it can be downloaded from a remote location (by the loader, also known as a Downloader).
with a tool called nanodump, exported the output, and processed the output offline with Mimikatz.
ipconfig
Creating the HKCU\Software\Zeppelin registry key
obtaining relevant device data, such as OS version and architecture, hardware ID, CPU, RAM, screen resolution, system language, etc.
Both of them are encrypted,
by exploiting the following vulnerabilities against Microsoft Exchange servers
A service account, with Domain Administration permissions, was used to create a remote service on a Domain Controller to move laterally.
stores every pixel as three numbers according to its red, green and blue components
handles communication between the modules and attacker’s C&C server.
the DLL was injected into the memory of the svchost.exe process
two batch files were run.
browses a directory
Command and Scripting Interpreter: Windows Command Shell
the threat actors executed a PowerShell command to disable Windows Defender Antivirus on the host
bat file format
more specifically by credential stuffing
and the creation of a schedule task.
a remote service was created with random alphanumeric characters, service name and service file name
used process hollowing to launch under the context of the Dllhost.exe process
Decoded IronPython script
The attackers may use wmic to obtain information and run various commands,
When byte code bites Who checks the contents of compiled Python files
some of the deobfuscated strings from the installer\nare used for logging error messages and
This line uses the ShellExecute method of the Shell.Application object to execute the downloaded file.
used API calls in their droppers, such as  CreateProcessA, WriteProcessMemory and ResumeThread, to load and execute shellcode in memory
Base64 encoded RAT execution command
After the validation of the JSON and Base64 decoding
APC routine argument in the case of NtQueueApcThread,
a check against blacklisted processes.
Once user credentials have been compromised, this tool takes “full control” of the account
Version of the Oracle
its C2 server consists of\nJSON data exchanged via HTTP POST requests.
Take screenshots with a specified frame rate, and livestream or record them.
to extract the URL, login, and password fields from the file
Performs payload injections through syscalls via mapping a shellcode to a remote process and creating a remote thread.
Decompiled code responsible for loading the payload from the binary’s resources,
Keylogging
deobfuscates and runs another block of code
LSASS dump in c:\tmp detected and deleted
Latin American Governments Targeted By Ransomware
a malicious template file is downloaded and executed
These payloads are compressed inside RAR files, this helps avoid static analysis techniques
T1056.001
Returns OSVERSIONINFOEXW and SYSTEM_INFO structures
remote access and surveillance features
cmd /C
The CMD file contains commands
injects the Trojan loader into exe.
Take screenshots
the “UsingTask” element defines the task that will be compiled by MSBuild.
It then picks one random C&C URL out of the three available and constructs a GET request
LSASS Dumping
The threat actor was observed deleting files that had been dropped to disk
collects system information and browser history, then sends it to the C2 server.
for its execution technique of hiding malicious code inside log files.
then created a WMI event subscription in order to execute the\nbackdoor
capturing screenshots,
the embedded .NET injector and PE payload(s).
a heavily obfuscated script
It sets up a run key for the command C:\programdata\netsky\netsky.exe online for persistence.
deletes,
which was then fed to a batch script
Potential hidden files
decodes it
C:\Windows\system32\cmd.exe /C
Do Not Cross The RedLine Stealer Detections and Analysis
service is then created
Embedded Executable Objects In OneNote  
downloads several additional files and saves them to the victim's machine.
cyber actors use the VPS as well as small office and home office (SOHO) devices as operational nodes to evade detection.
These scripts contain an embedded PE loader to execute an embedded malware payload.
The decompression function
the threat actors had to first compromise two privileged accounts and leverage them to manipulate the Azure Active Directory (Azure AD) Connect agent.
the hardcoded key to decrypt the configuration file.
is injected in a similar way
malware pulled down and executed a Cobalt Strike payload on
A user had to click on this in order to execute the malware.
the API calls
cmd /C "C: & cd \ & dir $temp\ /od"
This backdoor executes arbitrary PHP code sent in POST request parameters.
Several more beacons were also loaded on the host using DLLs and PowerShell.
injected thread
Packed DLL analysis
The injection\nprocess
decrypts it with XOR
drops an embedded payload, which is a DLL file
The ISO file was delivered as a ZIP archive via a malicious spam mail campaign.
which downloaded obfuscated PowerShell and executed it in memory:
Disabling Windows Defender notifications, Disabling Task Manager, Disabling command prompt, Preventing users from accessing Windows registry tools, Disabling Run command, Modifying the display timeout
creates a batch script that,
we find an XOR loop that decrypts this configuration.
ExConti and FIN7 Actors Collaborate with New Domino Backdoor
It creates directory listings
and remote monitoring software such as ScreenConnect, Remote Utilities, and eHorus.
to trigger the retrieval of the final stage payload
– proxy server address and credentials
which use certutil (renamed here as slaughterhouse.exe) to decode
folder c:\programdata
creating a registry key HKCU\Control Panel\Desktop
Restart Telnet brute forcing
Maintain Presence via Windows Service Installation
Steal files which are printed by the victim
enumerating the Process Environment Block (PEB)
done via the GetAsyncKeyState API,
Decompresses a local buffer
actors used tools such as PCHunter, PowerTool, GMER, and Process Hacker to disable any security-related services running in the system.
Downloads and uploads files to and from the victim’s machine.
using UltraVNC to download and store\na file
Files and folders of interest are collected as well and staged for exfiltration.
cmd /C
The actors exploited Log4Shell for initial access to the organization’s VMware Horizon server.
Retrieves  system default language, timezone and OS version
injecting itself into a running explorer.exe process
is generated from the system username
the encrypted with AES-128 beacon
multi-hop proxies
persistence is established by using the ITaskService COM interface to create the \Microsoft\Windows\CertificateServicesClient\NetTask scheduled task
The team found plaintext credentials to an API user account stored in PowerShell scripts on an MDM server.
the malicious executable to unpack itself.
remote process the payload gets injected to.
Injecting into the rundll32.exe process to hide usage of Mimikatz, as well as injecting into a running legitimate explorer.exe process for lateral movement.
then collects the credentials, host information, files,
This allows it to download and deploy
The exploit payload then downloaded mdeploy.text
three layers where one decodes content for the next
create scheduled tasks for persistence.
downloads and executes
by redirecting calls to the Windows Sleep API to its own function
frequently called API function
it can create a service or scheduled task.
execute commands via scheduled tasks/jobs.
Propagation through GPO
was executed via rundll32.exe
From a persistence point of view, scheduled tasks
These arent the apps youre looking for fake installers targeting Southeast and East Asia
 reads the encrypted configuration filecan
an encoded PowerShell command stage, obfuscating the activity further than just simple string concatenation.
this snippet of code invokes ptrace with PT_DENY_ATTACH (0x1f) which will kill the process if a debugger is currently attached,
the dropper is distributed in the form of a UPX-packed DLL
logs keystrokes
a part of code from the .text section (roughly 8 KB) is overwritten with heavily obfuscated code
which are typically transferred as an encrypted 7zip file.
decrypt the payload
uses the win32api.GetDiskFreeSpaceEx() function to retrieve the disk size in bytes
Credential theft and password spraying
to download additional malicious files
have used droppers that inject the payload into legitimate processes
SFX archiveWhen unpacked
IronNetInjector Turlas New Malware Loading Tool
For instance, immediately after execution, it loads itself in memory, and deletes itself from the disk.
to obfuscate their tools
write a batch file to disk that executes the Fantasy wiper, and then run that batch file via PsExec with this command line string
Downloading files remotely
obtains the list of processes
used by the threat actor for the remote management of Tactical RMM Agent.
Decodes sensitive memory regions in the current process with the same XOR key
The actors exploited Log4Shell for initial access to the organization’s VMware Horizon server.
Two ".bat" files were sent throughout the organization.
this is done via the popen API
downloads and executes
The Powershell script, when double clicked (executed),
creates another group policy
This evasion technique overwrites the .text section of the pre-loaded ntdll library with the freshly loaded one so that the hooked API addresses are recovered with the original API address
downloading and executing two other PowerShell scripts from a different attacker-controlled server
Nationstate threat actor Mint Sandstorm refines tradecraft to attack highvalue targets
shellcode decompressing and loading
decrypted using the RC4 algorithm with a hard-coded key in the resource.
downloads and executes a malicious backdoor
perform WMI queries
shows that their offsets within the encrypted region remain the same since they result in a similar shellcode even if they are composed of different bytes per binary.
showing wab.exe executed by WMI
the embedded DLL
creates a batch script
C:\Windows\system32\wbem\wmic.exe /node
Malicious documents that implement this technique require users to double-click a document element.
The Telnet brute forcing code is designed primarily for self-propagation
inject processes that are expected to communicate over the network
Windows Management Instrumentation
The FileData member of the FileDataStoreObject is the key member that holds the embedded data in the OneNote document.
an exported function from one of the Windows libraries
brute-forced devices
obfuscated with FinSpy VM.
in an effort to evade any detection and prevention mechanisms, they disabled Windows Defender
have used RATs that allow full access to the Registry,
The threat actors consistently perform extensive lateral movement actions using the acquired credentials within a targeted environment.
cracking browser sensitive information like passwords
sent as a POST request
Fantasy  a new Agrius wiper deployed through a supplychain attack
func_GetGraphicCards
using low level APIs: NtCreateSection, NtMapViewOfSection
Too Log Didnt Read  Unknown Actor Using CLFS Log Files for Stealth
encryption
For example,\nto open a registry key in a transaction, the functions\nRegCreateKeyTransacted(), RegOpenKeyTransacted(), and\nRegDeleteKeyTransacted() are available.
as a hard-coded XOR key
Uninstall the backdoor.
A new batch file, localdisk.bat, was also executed
exploit targeting a public-facing appliance vulnerability.
decompresses it using the GZipStream API,
hash of the dropped loader to change with each execution,
cyber actors have been observed using a network of VPSs and small office and home office (SOHO) routers as part of their operational infrastructure to evade detection and host C2 activity
two large arrays of decimal bytes were decoded by the function
dynamically loads the library
heavily obfuscated batch file is hidden and automatically executed when launched.
CatB Ransomware  File Locker Sharpens Its Claws to Steal Data with MSDTC Service DLL Hijacking
“wmic os get LocalDateTime /value”.
leveraging comsvcs.dll with proxy execution by rundll32.exe.
WmiPrvSe.exe (WMI Provider Host) executed the PowerShell Cobalt Strike beacon on the remote computers.
the threat actor primarily focuses on four different known remote code execution (RCE) vulnerabilities during their operations:•    CVE-2023-21839      Oracle WebLogic Server RCE [13]•    CVE-2021-3129      Laravel debug mode RCE [14]•    CVE-2020-2551      Oracle WebLogic RCE [15]•    CVE-2021-44228     Apache Log4j [16]
file is a Python program packaged by PyInstaller.
accessed C2 while visiting port 80
executable abused to side-load malicious DLL 
Windows task XML file
victim controlled hostnames were revealed
"w.bat" as viewed through the bash command "cat":
cyber actors have been observed using multiple implants with file system enumeration and traversal capabilities.
kernel32.VirtualALloc
and enumerating files and drives
the payload is either loaded into its own process or a remote one.
unpack any additional payloads,
reg.exe add\nHKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
a downloader that downloads and executes a payload
Process hollowing is a process injection technique that creates a new legitimate process in a suspended mode, unmaps its main image and replaces it with malicious code.
It makes direct system calls using the “syscall” instruction.
T1484.001
injecting it into an svchost.exe process,
The user is also asked to permit push notifications in the browser,
using a domain administrator’s account.
invoking comsvcs.dll with rundll32.exe, an adversary can create a dump of any process
then determines the processor architecture
passes two arguments to the "mw_resolveAPI" function.
the threat actors leveraged highly privileged credentials and access to domain controllers
checking on running tasks,
allows cyber threat actors to execute arbitrary system commands,
wmic  /node
the list of processes
to download next stage and execute it
The Decryption shellcode has three main tasks: first, it extracts the Loader shellcode and the payload, then it decrypts them, and finally, it transfers the execution to the decrypted Loader shellcode.
downloaded and run by the plaintext PY files from external infrastructure.
The application and the accompanying relevant and malicious DLL were both embedded in the loader’s resources.
the threat actor was making authentications to O365
can send system information
replace the “ServiceManager.exe” file from the driver folder with a malicious file to trick the driver into running the tainted file
It will then create a reverse shell via ncat.exe to the server
cyber actors have been observed importing tools from GitHub or infected domains to victim networks
using privileged accounts and then accessed the wiki using a different set of credentials.
".bat" files
Remote Command Line
Name of the malicious side-loaded DLL
Exfiltration Over C2 Channel
decrypting them
The next stage, injected into iexplore.exe
from a process that was injected with Cobalt Strike.
The intrusion began when a user double clicked a LNK file, which then executed encoded Powershell commands
Standard TCP connection
Side loaded malicious DLL 
The payload from the project files was a remote access tool (RAT) called Remcos.
the operator executed several Windows commands
API calls
malicious actors spread primarily by spearphishing campaigns using tailored emails that contain malicious attachments
packed by noted tools
PE injection, manual loading into the parent process
resulted in confirmed compromises of internet-facing Federal Government agency systems.
the malware proceeds to identify files and directories for encryption by iterating through them
attacker’s Kali Linux host to RDP into our target’s environment
uses various WinAPI functions to run malicious shellcode in the current process or to inject it into another process
This type of threats is usually delivered as email attachments.
sends a request to the attacker-controlled Telegram channel
the tool downloads the files
which unpacks
delete important files
run the payloads by sideloading them to the legitimate executables
cyber actors used valid accounts to log into a service specifically designed to accept remote connections,
the full HTTP request to make the first connection to the C&C
the batch file
following base64 decoded header
data exfiltration over a hardcoded C2 server
adversary using Windows Batch files
collect and upload information about the device
injects it into the created process
Lots of custom scripts dropped by threat actors
used for HTTP server responses
an increasing number of obfuscations are being adopted to thwart static analysis.
RDP connection established
dispatch an asynchronous procedure call (APC) to the APC queue of a target process thread using NtQueueApcThread
a base64 encoded argument
The team used this root access to move laterally to SBS-connected workstations.
can create a new threat with the malicious unpacked payload.
Then the functions are used to load and decrypt the payload.
Employing Python scripts to exploit vulnerable servers.
the decryption routine
used Ngrok to proxy RDP connections and to perform command and control.
the Content-Key, which is a custom HTTP header whose value corresponds to a hash generated out of the HTTP header.
The use of shellcode, encoding, compression, obfuscated strings
T1543.003
dropping and the execution of several payloads using multiple techniques
several different Mimikatz implementations were executed on the domain controller, including a Mimikatz executable
RDP traffic and minimize external RDP access
cmd /C "C: & cd \ & arp -a"
attackers placed
including the computer name and the OS version of the compromised system were sent
stored within the registry
Carbon Blacks TrueBot Detection
This shows the decoded and uncompressed data.
acquire browsing histories, Internet cookies, usernames/passwords, personally identifiable details, credit card numbers, and other highly sensitive information from browsers.
used to dump information from the victim’s Oracle database.
Write a registry Run key
an information stealer used to harvest internal information.
as several adversaries are exploiting CVE-2022-47966 for initial access.\nApache Log4j2 (aka Log4Shell)
password spraying attack against the victim’s remote services,
They then force updated the GPO on all clients using Cobalt Strike.
unpacking the Orchestrator
Use of non-secure default configurations
and the same key is used to decrypt the MFT.
creates two different scheduled tasks.
Decoded from Base64:
It checks running processes
This decryption process utilizes the Fernet algorithm
Tools were transferred to a compromised web-facing server
They started by connecting to a new server via RDP
to identify if privileged users are active on the systems
RDP traffic
leads to payload delivery through the execution of a PowerShell downloader script
injects itself and additional malware(s) into all processes
suspicious email attachments or other phishing techniques.
one Zip contained a benign file named screenshot1242.jpeg and another contained a file named privatecopy.pdf.
have been observed using Base-64 encoded commands
then proceeded to access lsass memory on the host to extract credentials.
This version of Mimikatz has been compressed using UPX
files have XOR-encrypted content to prevent detection
of a Security Package into LSASS using RPC calls.
Process Hollowing
LSASS Dump
decrypting them on the fly.
Attackers use domain fronting technique to target Myanmar with Cobalt Strike
directory listings
Identify processes related to backups, antivirus/anti-spyware,
As the hosts receive the task through GPO
"C:\Windows\System32\schtasks.exe" /create /sc MINUTE /mo 15 /TN
Detect and identify source IP
a fake message to lure users to execute the HTA  file 
encrypted Base64 string containing the session GUID
System Network Connections Discovery
began enumerating the network using native Windows binaries
via reverse proxy.
creating a hash of the collected data, to which it then appends its current process id.
cmd.exe" /c
parsing payload received in the C&C responses
malware creating and executing a normal Hancom Office file with the same filename as the malware within the same directory where the malware was executed.
deployed additional tools
where they were previously injected into
The team ran the DFSCoerce python script, which prompted DC authentication to a server using the server’s NTLM hash
spear phishing emails pretending to be from financial vendors or partners to trick users into opening the malicious attachments in the emails.
decrypts them
the ransomware uses the FindFirstVolumeW() and FindNextVolumeW() API functions
was decoded
HTTP Parent Beacon
AnyDesk logs, %ProgramData%\AnyDesk\ad_svc.trace and %AppData%\AnyDesk\ad.trace, show that it was used during Day 1 and Day 7 of this intrusion
reg  add "HKLM\SYSTEM\CurrentControlSet\Services\iscsiwmi\Parameters" /
sends the output of ipconfig in a POST request
cmd /C
cmd /C
These were used to inject the payload into process memory.
file stealer
This can be useful to determine drives, including mounted network shares.
the threat actors accessed it through RDP, which is an open session that evades MFA blocking their activities.
The actor leveraged Impacket’s wmiexec.py to execute commands with a semi-interactive shell
yielding a PE file that is loaded and run in memory with .NET.
the actors used RDP
The team ran the DFSCoerce python script, which prompted DC authentication to a server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT.
Process Injection method
Kimsuky Strikes Again  New Social Engineering Campaign Aims to Steal Credentials and Gather Strategic Intelligence
regularly obtains the list of running processes.
is distributed through exposed Remote Desktop Protocol (RDP) setups
that deletes the Fantasy wiper from disk and then deletes itself.
using Active Directory group policies allows the malicious actor to hit all systems in the environment for as long as that group policy is active in the victim’s environment.
Process Hollowing
enumerating the processes’ threads,
The batch-files appear to be used to load the Cobalt Strike beacon, but also to perform discovery commands on the compromised system.
can send and receive data over HTTP.
T1562.001
threat actors use their beacon sessions to establish RDP access through a reverse proxy
steal database passwords and configuration information
Making a ‘POST’ request,
It downloads and runs an executable payload
download and execute binaries of various architectures until it succeeds
HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection \nDeleteKey 
download of a batch (.bat) file.
writes its encrypted C2\nconfiguration into the system’s registry
the file to be downloaded.
Exposed RDP servers are also abused by threat actors to gain initial access into a targets network.
SeDebugPrivilege
Base64
The Microsoft WinCrypt library is used for AES encryption and decryption by both
added to the email address collection array.
calling the RegisterClass function prior to calling CreateWindow.
The second stage payload, which was later determined to likely be the penetration testing framework "Brute Ratel," was then downloaded via a connection
ZipJar a little bit unexpected attack chain
“When a victim opens the HTML file attachment, an embedded URL is launched in the victim’s browser, redirecting to another malicious HTML file from an attacker-controlled AWS EC2 instance
USING ".BAT" FILES
Create scheduled tasks to execute the loader and updater components
The threat actors also moved laterally to the domain controller, compromised credentials
the threat actor was seen establishing RDP connections
used different sets of defense evasion and reconnaissance tools such as GMER and Advance Process Termination to manually uninstall antivirus products on the target system.
the hacker also changes the content of the file RedirSuiteServiceProxy.aspx to webshell content.
Loader removes evidence of injection by using the following methods:\nUpdate the LDR data table entry to match the injected PE.\nRemove the injected PE headers from memory.
team attempted to determine valid accounts based on group name and purpose
an encoded payload split across several nodes, further complicating its extraction.
The actors used built-in Windows user account DefaultAccount.
cyber actors have been observed deleting files using rm or del commands.
Transport-level protocol
creates directory listings
starting the RDP session
The credentials also allow BlackCat to move laterally within the victim’s system and/or network, often with administrative privileges.
They may also use the wmiexec module from Impacket to execute commands and move across the network.
decrypting the rest of the blob once it has been decoded.
lures the user to open a document.lnk file which will execute the malicious DLL loader
Decrypts the Trojan with a XOR-based cipher
execute a payload via SMB and Windows Service Creation, respectively, on a target DC.
deletes all files written to disk in the current working directory
suspicious APIs often used in code injection techniques like CreateRemoteThread or NtSetContextThread.
by modifying the Windows Registry on compromised systems.
".bat" files designed to disable Cisco AMP / Microsoft Defender
decrypt network traffic
looks for specific processes
The threat actor established RDP sessions to internal servers
They then opened an RDP connection back to the primary domain controller
a batch file
Stolen certificates in two waves of ransomware and wiper attacks
successfully got a valid domain admin account this way.
the Loader overwrites the current PE with the final payload’s PE
and executing via a remote service on another workstation.
T1570
The data blob in HEX decodes
SMB copy and remote execution
It copies other malicious batch and EXE files from a compromised internal Server Message Block (SMB) server to the newly created temp folder
the ransomware will proceed to spawn another instance of itself via rundll32.exe
it attempts to establish a connection with the remote server to retrieve the subsequent component of the attack
kernel32.GetLastError
Operation Harvest A Deep Dive into a Longterm Campaign
launches several processes
The second shellcode revealed after the unpacking algorithm finished processing
C:\Windows\system32\cmd.exe /C
System Information Discovery
the malware tries to remove itself from the machine to avoid being detected and analyzed by security researchers
to proxy the miner’s network communications.
scan hosts for so-called Eternal* SMB vulnerabilities with SMBTouch and then, where possible, run the EternalBlue exploit and infect the computer
is a memory-only DLL that runs as a service
obtains all entries within the IPs starting with 192., 10., and .172 in the ARP cache table
to steal Outlook data such as server, user, and password from POP3, SMPT, and IMAP registry keys
Creates a memory section with the DES-encrypted malware configuration
This trampoline is protected with an obfuscator
using Mimikatz and dumping lsass,
a string that will be decrypted
to gather basic system information, including username,
Supply Chain Risk from Gigabyte App Center Backdoor  Eclypsium  Supply Chain Security for the Modern Enterprise
through the command line as
"C:\Windows\syswow64\cmd.exe" /C
decrypt
various WinAPI functions.
T1112
the mining proxy
The malware then abuses the MSDTC service, manipulating the permissions and startup parameters.
wmic  /node
After execution, the output of commands is uploaded.
launched with a command\nline
successfully obtain the database passwords
CrowdStrike Uncovers I2Pminer MacOS Mineware Variant
activity from Tor
GetExtendedTcpTable to retrieve a list of TCP endpoints\nGetIpNetTable to retrieve
T1204.002
decrypts the Orchestrator
gather database passwords
Collected machine information includes the following:\nRandomly generated GUID\nHostname
loads a fresh copy of ntdll.dll,
Returns the path to the ‘Program Files’ folder.
The identical encrypted file
the threat actors made attempts to proxy RDP traffic
Usage of WMI for remote command execution
The fields required for HTTP
data can be collected locally by the corresponding class before it is staged for exfiltration.
uses TCP for C&C communications.
decode
used various RATs that can browse file systems
encrypted with RC4
Uses Rundll32 to load and execute malicious DLL.
cmd /C
exploiting vulnerabilities in the remote desktop protocol (RDP).
The HTML attachments used HTML Smuggling to drop a password protected, zipped Windows Script File (WSF).
Windows API
Decrypting and exporting browser data
Use Windows API functions
C:\Windows\system32\cmd.exe /C gpupdate 
The threat actors downloaded the lsass.exe beacon from their attacker hosted infrastructure
contain encrypted C2 strings
code is protected and obfuscated
a legitimate tool which is frequently used by bad actors for malicious purposes in ways similar to TeamViewer
Pack it Secretly Earth Pretas Updated Stealthy Strategies
cmd /c
obfuscated .NET file using process hollowing, which is a code injection technique in which an attacker removes legitimate code from an executable and replaces it with malicious code.
it proceeds with scheduled task creation
BlueNoroff introduces new methods bypassing MoTW
Affiliates have been seen brute forcing exposed RDP services and compromising accounts with weak passwords.
Attempting to use sc stop and taskkill to stop over 100 services related to various areas ranging from remote desktop tools to Windows Defender
was deployed using DLL side-loading
use several highly obfuscated and underdevelopment custom loaders
utilizes Telegram for delivering payloads
containing the encrypted bot and DLL loader.
WMI was used for running commands on remote systems
WinAPI file manipulation functions.
the malware starts a function called bypassSMADAV
post-exploit tool that leverages HTTP protocols for C2 traffic.
the NtTerminateProcess and ExitProcess functions
injects the fetched payload into the explorer.exe process
group utilizes sideloading
the standard Windows command line tool cmd.exe.
runs rundll32.exe to load the malware.
Read a binary from its resource section, write it to disk and execute it
deobfuscate it.
obtains a list of installed security software.
archive is unpacked to a temporary folder.
such as a keystroke logger
The threat actor renamed their utilities to masquerade as legitimate system binaries (AdFind as svchost.exe), match the system’s role (GoldMax), or appear legitimate (TrailBlazer as an apparent Adobe utility).
the team leveraged compromised workstation and domain admin accounts to execute a payload
malware disguised as Hancom Office document files.
A flight of netlogon authentications were observed from the beachhead host to the domain controller as a possible attempt at exploiting the domain controller.
It creates a new Shell in the registry.
cmd.exe /C
It usually pretends to be a legitimate file, such as an Adobe PDF or Dropbox file,
WMI permanent event subscriptions can be used to trigger actions\nwhen specified conditions are met.
steganography [T1027.003] to hide stolen data inside other files stored on GitHub
Bypass User Account Control;The attackers may bypass UAC using the ICMLuaUtil COM interface, as well as use the Masquerade PEB method.
modifies the Windows Registry to allow remote desktop connections
Once the data has been written to the registry
a script to download, configure and execute
SCHTASKS /Create
used PowerShell to download and execute
The DLL’s used were side-loaded in memory on compromised systems.
Gather computer-specific information such as computer name, username, gateway address, network adapter details, Windows version, and user type
downloaded code chunk
used various RATs that can capture screenshots of victim machines
persistence was achieved by creating a ‘Run’ key
Start of encrypted and compressed loader configuration and payload
the files are sent through an HTTP POST request.
the service account password was weak and cracked offline by threat actors.
decrypted using DPAPI
Collects the configuration of active connector instances other than the RPCConnector and RPCBindConnector classes.
Read (IRP_MJ_READ) for the keyboard driver (kbdclass or KeyboardClass0)
SMBv1 Exploitation via EternalBlue
90 other encrypted
it acts as both a keylogger
The tool allowlisted the entire c:\drive, enabling the actors to bypass virus scans for tools they downloaded to the c:\drive.
can communicate over raw TCP sockets.
C:\Windows\system32\cmd.exe /C
Then, the malware retrieves information on the compromised computer and sends it to the C&C.
BumbleBee Roasts Its Way to Domain Admin
When opened, the user sees a social engineering image telling them that they must click the “Enable editing” button to see the document’s contents.
the encrypted data
When decoded, a backdoor is revealed
injects into the svchost.exe process
How to Detect Cobalt Strike
shellcode from the .data section
host serial number
one victim in the UAE was attacked using a malicious Word document
Similar to decoding strings, the binary payload is extracted by decoding the data using Base64 and adding 35.
“cmd /c
passes the execution to the region of memory in which the copied PE is allocated
other compromised host running the parent HTTP Beacon
encrypts communication with C&C using AES in CBC mode
Evasive Process Hollowing By Entrypoint Patching
Disables Windows Defender with batch scripts
cmd.exe /C
Uninstall a plugin from the machine
Tactical RMM is a remote management software platform that uses a combination of agents to allow for remote management and access to systems.
with the syscall instruction
exfiltration of files
injects it into a process.
To remotely access the compromised infrastructure, the attackers may use Cobalt Strike, TeamViewer and ScreenConnect
“BfeOnServiceStartTypeChange” WMI\nQuery Language (WQL) filter condition\nThe BfeOnServiceStartTypeChange Filter was\nbound to the CommandLineEventConsumer WindowsParentalControlsMigration.
execute the command systeminfo on the compromised host.
The threat used valid accounts against remote services:
will make a HTTP GET request
BazarLoader Mocks Researchers in December 2020 Malspam Campaign
to steal system information like machine details
Hancitor Infection Chain Analysis An Examination of its Unpacking Routine and Execution Techniques
Gathering system information
It then calls CallWindowProcW API.
has the capability to exploit SMBv1 via the well known EternalBlue exploit.
Dead or Alive An Emotet Story
OS version information
The actors removed malicious file mde.ps1 from the dis.
run from their interactive RDP session
After this is decrypted,
the ransomware modifies specific registry values
  Upload file function 
, the above files no longer exist on the compromised system, possibly due to the hacker’s evidence deletion.
Upon opening the malicious document
Office documents weaponized
C:\Windows\system32\cmd.exe /C
has the ability to drop and execute additional components.
uses cmd.exe to download files from Alibaba Cloud Object Storage Service.
try to decrypt it using the RC4 encryption scheme with the key
use of W4SP crew obfuscation tools such as Hyperion and Kramer
capable of modifying Windows UAC prompt, disabling Windows Defender notifications, disabling Task Manager, disabling command prompt, preventing users from accessing Windows registry tools, disabling the Run command, and modifying the display timeout
It is also able to communicate through different network protocols such as UDP (User Datagram Protocol) and TCP (Transmission Control Protocol).
Malware Disguised as Document from Ukraines Energoatom Delivers Havoc Demon Backdoor
malware will attempt to gather specific, sensitive information from targeted systems.
several POST requests
It uses the cpuinfo Python module to retrieve information about the CPU.
delete the driver files.
manually disabled Windows Defender via the Graphical User Interface (GUI)
The final payload returned is a lightweight PowerShell backdoor,
encrypting the base encryption key with RSA (with a hard-coded 1024-byte public key) and encoding it in Base64.
Exfiltrate keylogger data
Disables MAPS (Microsoft Active Protection Service) reporting
Place a value on RunOnce key
contains the original MBR that was encoded by XORing
using stack to decrypt strings
C:\Windows\system32\cmd.exe /C
Uses NtSetInformationThread API
The team used HTTPS
Encrypted Channel: Symmetric Cryptography
Chinese Threat Actor Used Modified Cobalt Strike Variant to Attack Taiwanese Critical Infrastructure
command line argument
decrypts it using the denoted decryption key
to exfiltrate data directly to C2 servers.
used for function imports (via GetProcAddress)
Injected Processes
Logged Processes
RC4 key for decryption
reg.exe query
It then runs Stage 2 via process hollowing.
obscure the call by wiping artifacts from the buffer, such as wiping the PE header.
StopRansomware Royal Ransomware
triggered when the user starts the presentation mode and moves the mouse
and finds the trust relationships and jump hosts, attempting to move into the other domains and security zones.
operating system information
two base64 encoded data blobs and code instructions for its execution.
store\na file named update.lnk in the %APPDATA%\Microsoft\Windows\Start\nMenu\Programs\Startup\ directory
Download a file from the remote server
At the end of the decryption process, the program indicates the number of decrypted files
the logging strings are encrypted with a single byte in XOR operations as
Collectors are gadgets that retrieve a value already present in a register, and save it back into the attacker’s counterfeit object
to obfuscate the source of the\nactivity.
LSASS process to access credentials.
is executed as a command line argument
the team found a .txt file containing plaintext credentials for the user
All captured information from the transaction is saved to an encrypted file placed in a directory previously set by the malware configuration
uses cmd.exe and .bat files to run commands
 LockBit Ransomware 20 Resurfaces
storing the names or hashes of the APIs needed, then importing them dynamically at runtime.
the Forked Loader decrypts and copies strings into global variables where they will be later used to resolve required functions.
via the find.bat batch script.
The decrypted malicious code
T1036.005
unpacks with aPLib
The adversary installs a hackers best friend during the intrusion: Cobalt Strike.
executes one of the dropped batch files
AA20336A Advanced Persistent Threat Actors Targeting US Think Tanks
adopting publicly disclosed proof-of-concept (POC) code shortly after it is released to exploit vulnerabilities in internet-facing applications.
This obfuscated process
rundll32 locker_32.dll,run
TLS encrypted data
and decrypts config
unpacks
By extracting the syscalls, and executing them manually, the malware can use the API of the operating system,
The malware proceeds to de-obfuscate strings using a XOR loop
ease of batch file execution.
the processes used for injection
it also invokes the API NTRaiseHardError.
extract sensitive information,
Most strings in this version are base64 encoded.
uses a custom crypter leveraging Microsoft’s CryptoAPI to encrypt C2 traffic.
LoadLibrary and GetProcAddress functions
campaigns typically begin with a phishing email with a ZIP file attachment, containing a LNK file disguised as a Word document
embedded JavaScript Observed Notation (JSON)-based configuration to set parameters
enumerates system services to search for ones relating to security
lists the command line arguments accepted
List of installed security products
checks if the system is 64-bit
stored as obfuscated data in the registry
techniques like process hollowing where the process is created in suspend mode and then replaced with malicious code.
stored as obfuscated data in the registry
creates a registry Run key to achieve persistence
decrypts strings
decrypted and injected
transmits information as a zip file
It decrypts and loads
has installed and used PsExec to execute payloads on remote hosts.
It provides\napplications with API functions—available
to push batch files over SMB to other systems within an internal network.
used Rotten/Bad Potato to elevate user rights by abusing API calls in the Operating System.
the stolen credentials are used to reach high-value machines like servers
HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Monitoring\DisableRealtimeMonitoring \nDeleteValue 
This function is responsible for deleting all files and directories in the user’s trash folder.
Decrypted strings
If Windows Defender or Bitdefender Antivirus is installed on the victim’s computer
ListUsers
Using the Cobalt Strike beacon, the threat actors transferred AnyDesk (1).exe file from the beachhead to a server:
some strings, such as web browser paths and Geolocation API services URLs, are encrypted with the AES algorithm in cipher-block chaining (CBC) mode
use Registry Run key for persistence
:taking full control of the infected machinerecording keystrokes in real time with
uses the Windows Application Programming Interface (API) call, CreateProcessW(), to manage execution flow.
to run the subsequent BAT scripts
screenshots
can use the Active Directory database to access credentials for users’ accounts.
The config is decrypted using XOR and a 16-byte key
Exploit Public-Facing Applications
C:\Windows\System32\cmd.exe /C
an embedded executable
Zerobot HTTP requests
wiping traces of malware from the system
The victim double clicks the ISO to mount it
cmd /c
This downloader simply downloads the loader
Bypass UAC
encryption
process enumerations.
This technique leverages CDNs associated with high-reputation domains so that the malicious traffic appears to be directed towards a reputation domain but is actually redirected to the red team-controlled Cobalt Strike servers.
creates two Windows shortcut files in the Windows startup folder using the Internet Explorer application icon and the target paths pointing to the two dropped batch scripts.
operators utilize RDP to move laterally in the victim’s environment.
by adding the below to an already linked GPO.
Unpacked file names
Identify processes
support C2 connections via an external HTTP/SOCKS proxy
Delete a recording with a given filename from the system.
there was only one stage being decrypted in memory
send traffic simultaneously to one server,
the team uploaded and executed well-known malicious files
uses a custom PL format with encryption
decrypt the embedded module
Necessary APIs will be dynamically resolved during execution.
the Loader copies the new PE headers to the base address and each section to the relevant location according to the IMAGE_SECTION_HEADER
attacker use of WMI
protected with an obfuscator
batch files for automation.
uses the command shell to run appropriate commands
Like the earlier SSH brute-forcing campaign
moved laterally and\ndeployed their signature malware
cyber actors have been observed using the mv command to export files into a location
The ISO files that X-Force observed contained a LNK file
In an attempt to remain undetected, AddSecurityPackage64.dll disables Windows event logging by killing threads of the Windows Event Log service without stopping the execution of the service itself
relies on other parts of the HTTP request, including the Host header and the actual C2
cmd /C
same IP address was used as C2 server
script that downloads a file from a fixed location and executes it.
contains an XOR-encrypted payload, divided into three files
To obtain the credentials, the team took a snapshot of lsass.exe
Stops the WinDefend service (Windows Defender)
Recent TZW Campaigns Revealed As Part of GlobeImposter Malware Family
invoke any API we like,
Victims will receive and interact with a decoy document containing a Google Drive link and a corresponding password instead of an archive download link embedded in the email.
This is done via the GetAsyncKeyState API, with keystrokes being logged
executes the compiled AutoIt script
encrypted portion of the data is decrypted
operators open up an Remote Desktop Protocol (RDP) port
This value is decoded
operators were able to access their primary target via RDP connections\nfrom a trusted third party using stolen credentials
Downloading, decrypting, and executing a backdoor payload from an attacker-controlled server
An example of the creation of such a scheduled task by the adversary:\nschtasks /create /ru "SYSTEM" /tn "update" /tr "cmd /c c:\windows\temp\update.bat" /sc once /f /st 06:59:00
decrypts another executable
the malware uses a set of credentials that is hard coded into the malware binary,
sideloading to legitimate executables
delete files upon completion—including
is a Base64 encoded script with various components split into different variables for obfuscation purposes.
writes the extracted email addresses from the array to a file called “.Outlook” created by the script in the roaming user profile’s Microsoft application data folder.
T1057
Revisiting the NSISbased crypter
“C:\Windows\System32\cmd.exe” CommandLine: “C:\Windows\system32\cmd.exe /c
collects and sends system information
it is written to the registry key SOFTWARE\\Google_Authenticator\\b52dKMhj,
This script called a combination of QueueUserAPC, GetCurrentThreadId, OpenThread, and VirtualAlloc to perform process injection of shellcode
MSBuild has an inline task feature
cleanup script used to remove evidence of the attack on a system
is injected into notepad.exe
threat actors used CS as the main Command and Control tool, dropped several payloads,
the actor introduced a downloader to fetch and spawn the next stage payload
the actors leveraged RDP to propagate to several hosts within the network.
The usage of a proxy allows authors to control all of their mining implants and their target pools via a centralized console
The response gets decrypted with the IcedID decryption routine,
the actors leveraging CVE-2019-19781 to compromise Citrix Application Delivery Controllers.
The Windows service was configured with the following options:Service Type: user mode service Service Start Type
TCP_HANDSHAKEFloods with TCP handshakes.TCP_SOCKETContinuously sends random payloads on an open TCP socket.
process creation library functions
with the function “WriteFile”.
goes through processes one by one
Capture keystrokes
Credential extraction from the LSASS process
Smoking Out a DARKSIDE Affiliates Supply Chain Software Compromise
If TrendMicro, BitDefender, or Windows Defender products are installed
Decrypt the request received using AES algorithm
a hidden directory
that would cause registry changes
screenshots
This beacon was then successfully executed via WMI
SSL encrypted traffic
the threat actor managed to continue to access the victim’s cloud environment
decrypts the password
domain name also resembled the legitimate Mexican Tax Agency domain, a tactic the attacker likely adopted to disguise malicious traffic.
The output is then parsed to the targeted process ID with the help of tasklist filters.
attempt to compromise the victim’s login credentials for webmail services
command line arguments
that contained various bat files,
authentication from a known attacker IP address into the Azure AD Connector cloud account.
HTTP POST request that contains\nthe command output.
executes the batch file,
attacker began adding the lwp-download command as a failover for wget and curl to enable downloading commands
making a HTTP GET request
Access to local password managers and databases to obtain further credentials
HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Monitoring\DisableBehaviorMonitoring \nDeleteValue 
Log in to O365 as a user with privileged access to cloud resources.
capturing screenshots
used various RATs that retrieve the current username during initial infection
encrypts data with a custom encryption algorithm before it is sent to the C&C server.
exfiltrates data to Google Drive.
the threat actors proceeded to deploy several remote management tools across the environment.
they are written to the registry,
Decryption of the URI within
T1071\nApplication Layer Protocol: Web Protocols
attackers take advantage of this technique using proxychains
outgoing HTTPS port 443 connections to  and  (the prior domain in reverse).
removed mde.ps1 from the disk
ProcDump deletion from the ProgramData folder of all targeted workstations after dumping their LSASS process:
are obfuscated with VMProtect
began sending spam emails, mailing new malicious attachments to continue spreading.
execute it with rundll32.exe
execute an encrypted payload located in the embedded DLL
This shellcode is used for decrypting
used to send program execution DEBUG and Telegram to deliver payloads and send commands.
Returns the current domain SID
It decrypts an encrypted payload,
two shellcodes contained in the compiled AutoIt script
text-encoded in base64
This payload is decrypted, decompressed, and then copied into memory
Downloading and executing PowerShell code
copies the payload to the folder C:\Users\Public\Downloads
enumerates system information such as hostname, shares, and domain information.
During the defense evasion phase, anti-malware and monitoring software is often disabled.
Files are deleted after use.
the malware retrieves information on the infected machine and sends it to the C&C encrypted with DES.
users still need to manually mount them and run the fake PDFs to trigger the infection chain
StartSendScreen, StopSendScreen
they disabled Windows Defender via a group policy modification.
used an AutoIt packer that comes heavily obfuscated.
packed using NSIS installer.
System info, including both hardware and OS info.
decryption.
Use a previously compromised domain admin account to upload and execute a payload via SMB
domain fronting
iterate through the entire file system,
from an injected process
by brute-forcing them
A threat actor could establish an administrator session
 A heavily obfuscated VBS
can read files,
accesses the memory of its host LSASS process and stores stolen credentials in a Mimikatz log file
loader is executed through rundll32.exe
with names invoking popular videogames such as Fortnite, Valorant, Roblox or Warzone2.
using a domain service account.
Obfuscated PowerShell script
taking command line arguments
stored in the Windows registry.
they connected to a domain controller and dropped three scripts; one to copy the ransomware executable to all hosts, one to reset every users password in the organization, and a final one to execute the staged ransomware payload using PsExec
which is unpacked only when run with a unique password, allow evading traditional signature-based detection.
perform process injection to masquerade as harmless processes.
the main task of loading malware is done by an embedded process injector.
that had the remote desktop service enabled.
Process Injection via Hooking
cmd.exe
and a batch file 1.bat were dropped on the host and the batch file was executed
inject it’s modules into various processes.
The base64 encoding starts with JAB that is a common pattern for UTF-16 starting with $
passed as an argument on the\ncommand line.
redirecting to another malicious HTML file from an attacker-controlled AWS EC2 instance.
the\noperators were able to access their primary target via RDP connections
Domain fronting is another method for concealing communication between the endpoint and the command and control servers.
hooks the kernel’s PsCreateSystemThread function
the threat actor renamed their systems prior to connecting to victim’s VPNs to match the victim’s system naming convention
The execution phase started with that password protected zip, which after extracting would show the user an ISO file that after the user double clicks
C:\Windows\system32\cmd.exe /C systeminfo
Hafniuminspired cyberattacks neutralized by AI
"cmd"  /c
to use this tool for remote management of its infrastructure.
Next, the threat actor transferred Sysinternals tool Procdump over SMB, to the ProgramData folders on multiple hosts in the environment.
LSASS process memory is one of the prime targets for attackers, as well as malware armed with lateral movement capabilities since it caches a variety of credentials
by calling WinHTTPGetProxyForUrlEx and WinHTTPCreateProxyResolver
Other tools and scripts were dropped onto one endpoint
a thread that decrypts and loads the fcClient module
the configuration file will be deleted
the threat actor succeeded in authenticating into victim O365 tenants
cmd /C
New RapperBot Campaign  We Know What You Bruting for this Time
executes a malicious script
utilizes comsvcs.dll to dump credentials from Local Security Authority Subsystem Service.
or raw TCP, for C&C server communications.
The emulated C2 Server is now running an HTTPS server
sends an HTTPS request
deploying a malicious kernel mode driver (“bring your own vulnerable driver” or BYOVD method) via exploiting a vulnerable Intel driver
then proceeded to dump credentials from LSASS.
by calling the GetNetworkParams API function
DLL is run with rundll32
create scheduled tasks to achieve persistence
execute a method from the .NET assembly
Embedded data in Data object
The user account was possibly compromised on the Linux server by using credential stuffing or password spraying:
contains several benign files that are written to disk (they are not part of NSIS binaries and they are not used at all by the installer) and two files that are malicious
IP addresses intended for scanning and the special “ping” IP address
creating scheduled tasks
downloading and executing
decyrpt its C2 configuration
the hidden view attribute in file explorer in reference to the ProgramData folder.
drops suspicious files on the attacked servers
RtlDecompressBuffer decompresses the provided buffer.
Name of the executable vulnerable to side loading
attempt to obtain system information
Due to TCP port 2222’s common use as an alternate port for SSH communication, the Malware Analyst recorded a manual SSH connection to the emulated C2 host
after receiving phishing emails containing malicious PDF documents [T
The threat actor in this case uses domain fronting with the Cloudflare Content Delivery Network
downloads the payload
T1055
Stops the Microsoft Defender Antivirus Network Inspection Service (WdNisSvc)
Once decoded, this executable, written in Rust and compiled with Cargo, gets the current date and time, and decrypts Chromium-based browsers’ encryption key 
Establish a session that originates from a target Domain Controller system directly to an external host over a clear text protocol, such as HTTP.
Sample string deobfuscation
base64 encoded text later in the file
Application-level protocol
cleanup script
T1095
encrypted stack strings
The backdoor writes captured\nkeystrokes to memory
the malware decrypts the saved passwords
uses a variation of AtomBombing that queues an APC to call memset to clean an RW region in ntdll.dll.
unpacks and loads the next stage of the malware, namely the main module
directories with random names of a consistent length were navigated to by the same user that ran the tool.
The threat actor was able to RDP to a backup server using the admin credentials they acquired.
downloads a malicious ZIP file
Communication with the C&C is encrypted using AES in CBC mode
Microsoft Windows Defender AntiSpyware Protection disabled
obfuscated the loader with many calls to a function that just prints some hardcoded values
decrypts and executes in memory
sends data to the C2 server
unpacks an HTML
computer name
It included a standalone file padded with over 200MB of blank spaces, likely to impede analysis of the decompressed ISO file.
the first lateral movement from the beachhead to the server using RDP with an Administrator account:
captures screenshots
the malware leverages various functions from the CryptoAPI, including CryptAcquireContextW(), CryptImportKey(), CryptSetKeyParam(), and CryptEncrypt().
the scriptlet of the batch file
IP address space
contained encoded executables and shellcode,
write the batch file on the remote system.
encrypts the Orchestrator’s pages with a cipher based on XOR and ROL operations and assigns the PAGE_NOACCESS attribute to them
to search machines for certain files
via a ZwCreateSection call
The threat actors used the compromised administrator account
And that Run key references a different Registry key
the threat actor began attempting to connect into the environment via VPN
Victims receive spear phishing emails with attached malicious zip files
cmd.exe /C reg add
utilize legitimate file paths to mask their execution.
Gotta Catch Em All  Understanding the NetSupport RAT Campaigns Hiding Behind Pokemon Lures
then the payload is executed using Windows API functions (VirtualProtect).
The minidump function of comsvcs.dll can be used to dump lsass.exe.
Tool Used to Steal Sensitive Information
keystrokes
threat actors use Themida packer to obfuscate the signature used for detection.
The threat actors then used these credentials to pivot from the on-premises environment to the Azure AD environment.
The threat actor then deployed Anydesk, which was the only observed persistence mechanism used during the intrusion.
exfiltrate proprietary or confidential information,
UNPACKING GULOADER’S SHELLCODE
the adversary copying results of the discovery phase, like file- and directory lists from local systems,
a GET request is sent to the C2 server.
SeroXen RAT for sale
another shellcode, XOR-decrypts an embedded PE file – the Dolphin backdoor – and loads and executes it using a custom PE loader.
call RtlAddVectoredExceptionHandler API
Some variants used a known UAC bypass method abusing the legitimate fodhelper.exe
DLL sideloading
The contents of hidden folder “me”, included several files and folders that were used for the execution
Strings are encrypted
tries to start its defined shell which has been swapped to a batch script (file2.bat) by the malicious actor.
the decryption process starts
Lateral Tool Transfer
decrypting,
loads and executes the decrypted
Adversaries use side-loading attacks for execution
The subsequent functions collect additional information such as the machine’s public IP address
used to proxy
user
used a heavily obfuscated PowerShell script
has been obfuscated with the same rel_jmp and fake-jb techniques
Side-loaded DLL name
used various RATs that gather system information such as computer name and operating system during the initial infection
ipconfig /all
call the NtTestAlert function
The script will decode itself
a batch file.
Directory listing functions
Once the PE file is injected and reconstructed in memory, the execution flow can be redirected to the injected code, enabling the malware to operate within the context of the compromised process.
setup a Registry Run Key to maintain persistence on the beachhead host.
entries point to buffers of randomly generated junk code
Adversary browsed several locations to search for the data they were after.
full command line argument
makes use of the technique “DLL Sideloading”
C:\Windows\system32\cmd.exe /C
Embedded Resource
the imported code dynamically calls VirtualAlloc to allocate a new region of memory in which a new PE file is copied.
TcpConnector and TcpBindConnector are classes responsible for connecting over TCP as client and server
Credentials that have either been reused across multiple platforms or have previously been exposed
NtTestAlert function
hop points to enable their cyber operations while remaining anonymous.
Once the payload is decoded
CMD-based scripts
That node contains the encoded payload.
the executables and sideloaded files
Windows Management Instrumentation (WMI) to launch commands on devices
The Orchestrator (as well as plugins) are packed with aPLib and encrypted with AES.
The base64 string
This is a multi-stage attack that involves sideloading DLLs,
the encrypted ScrambleCross shellcode
using the following command line:\n\n\nC:\Windows\System32\cmd.exe /c
Cyber threat actors also continue to identify large repositories of credentials that are available on the internet to enable brute-force attacks.
packed versions uploaded to VT
NotPetya Technical Analysis  A Triple Threat File Encryption MFT Encryption Credential Theft
collect information about loaded modules for each of the running processes
is encrypted in the standard way
Domain fronting was mostly used by web services to bypass censorship in several countries that restricted traffic
the RDP traffic was being proxied through
This method speeds up the brute forcing process
injects the rootkit when new processes are created
a different method of fetching and executing the next stage payload
they were looking to get valid accounts.
Next, they proceeded to transfer a beacon executable over SMB to the remote host’s ProgramData directory.
The values for these executables and configuration data can be found, encrypted, in the loader’s resource section.
a batch file
the threat actor executed a batch script
the adversary used the valid account to directly login
HTTPS activity from IP address  to the organization’s VMware server.
"cmd"  /c
The decoded payload
to download the malicious update.bat file from the C2 domain
AdFind was renamed to masquerade as a legitimate Windows binary
recursively removes the implementation of Windows Defender IOfficeAntiVirus under HKLM:\SOFTWARE\Microsoft\AMSI\Providers\{2781761E-28E0-4109-99FE-B9D127C57AFE}.
used to download files…
machine names
can check whether specific security software is installed on the machine it tries to compromise,
This process was invoked by RunDLL32.exe
encoded email addresses are exfiltrated
The OneNote file with the embedded HTA file
Upon execution, an attempt to alter the Windows firewall settings is made.
threat actor first ran some initial discovery on the host using built-in Windows utilities like ipconfig
With the DLL strings decrypted, the malware then decrypts the loader configuration by taking the first 64 bytes and XORing it against the next 64 bytes.
Investigation with a twist an accidental APT attack and averted data destruction
Decompressing the compressed file
then recursively searches through all local temp folders.
downloading and executing specific utilities
uploads it to the C2 server.
the encrypted data
keylogger
the script retrieves the Cobalt Strike payload
the rootkit module is decrypted
receives a ZIP file containing a benign file in plain sight
One of the observed commands invoked via WMI was ‘firefox.exe’.
some data exfiltration or interaction with the downloaded second stage from the C2.
With Rundll32,
Updated New Evidence Emerges to Suggest WatchDog Was Behind Crypto Campaign
domain fronting
is an obfuscating tool for Python script that makes the malware harder to be analyzed and detected.
the PowerShell being executed was Base64 encoded
execution using scheduled tasks
have used various layers of packers for obfuscating their droppers.
and decrypts them using XOR and the key
The threat actors dropped the first of their ransomware binaries on the fourth day of the intrusion
The downloading of the actual malware is done via a variety of possible commands (for example, wget, curl, tftp and ftpget).
The script concatenates hundreds of smaller strings into a single variable which ultimately builds and executes
executed by rundll32.exe.
decryption
the win32 function CreateServiceA was used by the malware
The threat actors also moved laterally to the domain controller, compromised credentials,
they’re downloaded from the C2
a cyber-attack in the form of credential stuffing,
call other vfgadgets that are responsible for executing specific operations, like Argument LoadersInvokers and Collectors.
Windows Management Instrumentation (WMI).
PE injection
the computer architecture
the adversary identifies data of interest from the network of the victim
Reverse proxy tool
screenshot capturing
Enumerates running processes
executes a CMD file
were both designed to turn off Antivirus and Antimalware software.
Execution of FRP reverse SOCKS proxy on infected host.
Once the victim opens the document,
modifying\nTerminal Server registry key values
NetSupport Manager, used maliciously or otherwise, provides full and complete control over the target device.
cmd /C
use a set of tools via remote desktop
config via the XMRig miner’s native API.
The actors used Ngrok to proxy
reg.exe ADD\n'HKLM\SOFTWARE\Microsoft\Windows\nNT\CurrentVersion\Winlogon\SpecialAccounts\UserList
creating a schedule task
Conti Team One Splinter Group Resurfaces as Royal Ransomware with Callback Phishing Attacks
files that where downloaded from those sites:
domains for domain fronting may indicate an interest in the geopolitics of this area of the world.
(crawl whole tree), I:, H:, G:, F:, E:, and D:.
a batch script or a specially crafted command line script.
cmd.exe /C hostname
to the C2 through the HTTP protocol.
SMB beacons are mostly used to make network detection harder and to get access to isolated systems where communication to the internet is prohibited
applies obfuscation techniques
downloading a specific payload
writes another batch file
the threat actors first used a compromised, highly privileged account to access the device where the Azure Active Directory (Azure AD) Connect agent is installed.
gains access to the targets through remote exploitation of an unpatched internet-facing device.
wmic product get name,version
writing the batch file to disk and executing.
the process into which the shellcode will be injected
When the attackers use Cobalt Strike, the collected information may be sent via Cobalt Strike server communication channels.
is encrypted in the file
Base64 encoded script
the malicious batch file
used for decryption:
it prompts the user with a fake message to double-click on open to view the attachment.
Username
leverages spear-phishing and tries to trick the victims into opening malicious documents
contains another payload that is XOR-encrypted
Microsoft CryptoAPI
using FindFirstFileW, FindNextFileW, and FindClose APIs
The team used domain fronting to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating.
scan specific IP addresses
Installing legitimate remote access tools, such as RPort, Ligolo and eHorus
The unpacked sample is approximately 540 KB
unpacking
and the use of valid accounts
an injection into a web browser process.
the decoded strings
sends GET requests with pull operations.
via the interactive shell
HTTP POST or GET methods
sends phishing messages with malicious attachments
In order to steal credentials, the attackers employ custom modified versions of Mimikatz
this key is typically obfuscated with AES 256 encryption.
try to hide these system calls
To launch the shellcode, the loader calls ZwCreateThreadEx to create a new suspended injection thread hidden from debuggers using the THREAD_CREATE_FLAGS_CREATE_SUSPENDED (0x01) and THREAD_CREATE_FLAGS_HIDE_FROM_DEBUGGER (0x4) thread creation flags.
Windows batch script
compromised devices that act as proxies for their C&C servers
this loader prepends a stub containing 79 bytes of junk instructions before the actual payload shellcode.
The task’s description is PythonUpdateSrvc and it runs either on Windows startup when a user logs in or when one of two system events get created:
creates a persistence via Registry Run Keys under HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
takes a screenshot
UAC bypass will be executed
using the API RegisterServiceHandlerA then SetServiceStatus, and finally CreateEventA.
cmd /C "C: & cd \ & systeminfo"
The Task Scheduler launches it at system startup
The payload is implanted into a newly created suspended process (a new instance of the current executable) using one of the most popular techniques of PE injection: Process Hollowing
Disables the startup of the WinDefend service
distributed inside an encrypted ZIP folder.
Qakbot Returns to ISO Delivery For Now
and then decrypts them
to download and execute a remote “note.hta”:
It utilizes symmetric key cryptography, where the same secret key is used for both encryption and decryption
injecting it to the address space of another process.
This misconfiguration allowed the team to use the low-level access of a phished user to move laterally to an Unconstrained Delegation host and compromise the entire domain.
the threat actors used PowerShell to download multiple malware and archives from the server
implemented process hollowing by first using VirtualProtectEx on the process entrypoint, and then writing the hook stub using WriteProcessMemory.
whoami
ipconfig
via the API\nNtCreateSection()
Analyzing Solorigate the compromised DLL file that started a sophisticated cyberattack and how Microsoft Defender helps protect customers
fetching the next stage payload
keylogging functionality.
tries to get access to the server via brute force
the communication is consistent with HTTP/S traffic.
brute-force passwords.
make use of  the curl utility to download Qakbot and then execute it.
The actors used Mimikatz to harvest credentials.
Once we unpack the file, we can see several elements, as well as directories typical for NSIS:
the victim’s hostname is captured in this logon event
executed via dllhost.exe using process hollowing techniques.
brute forcing tool called FSCAN.
decrypts the encrypted
Scheduled Task/Job: Scheduled Task
exploiting vulnerabilities in Apache and Apache Spark (CVE-2021-42013 and CVE-2022-33891
After obtaining a valid account, they use this account to access the victim’s VPN, Citrix or another remote service that allows access to the network of the victim.
its abuse of the legitimate MSDTC service,
to lure victims into downloading a malicious file
relied on their victims to execute the malicious MSI installers
these appear to be maliciously patched versions of the legitimate ffmpeg.dll
Target specific file path
calls the VirtualProtect function
the malware copied itself to "$CURRENTUSER\AppData\Roaming\Microsoft\Isoaahffo\djkuuhd.dll," as confirmed by the file's hashes shown below, and sets itself to auto run.
SSH brute forcing code with the more usual Telnet equivalent.
Vice Society Profiling a Persistent Threat to the Education Sector
The threat actor also engaged in brute-forcing against the victim's internal web services
schtasks /create /F /tn “\Microsoft\Windows\SoftwareProtectionPlatform\EventCacheManager” /tr “C:\Windows\SoftwareDistribution\EventCacheManager.exe” /sc ONSTART /ru system /
loader with rundll32
Decoded content
wmic /node
RedirSuiteServiceProxy.aspx is a legitimate file name available in the Exchange server.
Decryption of “Lite Loader” filenames.
Windows services ran with the highest privilege, NT AUTHORITY\SYSTEM and execute the malware automatically during system startup, allowing for remote access to the victim device with persistence.
Threat Advisory 3CX Softphone Supply Chain Compromise
utilizing string encryption
remote shell functions.
The decryption key and IV are\ngenerated using the same unique host properties
After the writing in the registry has been completed
The specific mechanism used to inject into a foreign process, was injecting arbitrary code into its memory space, and executing it as a remotely created thread
download and execute further shellcode
allows for lateral movement leveraging RPC to create SMB traffic.
the malware proceeds to decrypt the PowerShell code
System Directory
The malware then decrypts the received payload using AES and the shared key.
download this RAT,
The attackers enumerate drives, directories, and files
decrypt the\nData field.
It checks that there are no running processes related to security-related software (e.g., Windbg, Autoruns, Wireshark)
a function is called that decrypts strings that
then executed RDPEnable on the infected machine.
the adversary collected the data from various sources within the victim’s network.
Linux malware strengthens links between Lazarus and the 3CX supplychain attack
Enumerates all running processes
domain fronting
gets the list of recent files
binary unpacks a customized Mach-O
uses the DownloadFile method of the WebClient object to download the file from the specified URL and save it to the specified local file path.
the Rijndael decryption key is passed.
keylogging
have been routinely observed using a VPS as an encrypted proxy.
This requires either social engineering tactics to get the target to execute the malware or another program/script to execute the file.
via the API CreateFileTransactedA()
modifies registry keys to maintain persistence,
dropped and executed on the server
Windows registry Run key
including adding more command-line arguments
the deobfuscated SMOKEDHAM dropper.
the RC4 decryption method uses CryptoAPI (CryptDecrypt) instead of the usual substitution box method
implement different obfuscation techniques of varying intensities, for example, simple function name malformation and dynamic string resolution.
the raw disk driver was embedded inside the malware
Once the “.tmp” file is found, it is moved and renamed to the Office templates folder
web shell with filenames that masquerade as human.aspx, which is a legitimate component of the MOVEit Transfer software.
normal protocol uses raw TCP sockets and a custom message format
download, upload
Config decryption within IcedID Lite Loader.
has an embedded malicious URL
24 different IP addresses in use
C :\Windows\system32\cmd.exe /C shell whoami /all
routed through European TOR VPN exit nodes.
Calls CryptEncrypt
threat actors use their beacon sessions to establish RDP access
functions has been resolved by their hashes.
process listing
payloads are usually shellcode encrypted with a rolling XOR key.
contains obfuscated VBA scripts or a binary with a JPG extension
Several HTTP Post events were observed to the identified domains
the threat actors used a service account to execute a Cobalt Strike beacon remotely on a Domain Controller.
The inspected UEFI firmware was tampered with to embed a malicious code that we dub MoonBounce;
The malicious document is delivered in either zip files or ISO images to the target through phishing emails.
Masquerades its command-and-control (C2) traffic as legitimate Google Notifications HTTP requests
sideload a malicious DLL
These work in tandem to insert data into the Windows Registry
The decoded PowerShell instructions
the malware then proceeds to gather basic system information, including username, computer name, and OS version,
Though this is a very rigid method of hiding its codes,
base64 data block execution
transmitted using the lightweight networking module,
abused group policy objects (GPO) to install loaders
deployed in a multistage process that uses various obfuscation and encryption techniques to hinder analysis
ran another round of discovery activity with native windows utilities
obfuscated with junk instructions and inverted conditional jumps (combinations of jle/jg and the like).
Obfuscated HTA script
decompress them
Each manager stores collected data in its own SQLite database, while data that is collected on demand is returned directly to the C&C server
via the MoveFileExW or CopyFileW Windows API.
remote access tool
run the payloads by sideloading them to the legitimate executables
backdoors can list running processes.
It will then decrypt the encrypted payload with the predefined RC4 key
whoami
a reverse proxy tool for proxying an internal service
0x0BInject and execute received module in specified process
staging a credential theft capability in the LSASS process itself by abusing native Windows capabilities
can exfiltrate files from local file systems.
As LSASS dumps are nowadays recognized by the dump file itself
The threat actors continued by moving laterally to the domain controllers on the network using SMB to transfer and execute a Cobalt Strike Beacon
rundll32.exe binary downloaded approximately 0.4 MB of data.
Threat Actors Use MSBuild to Deliver RATs Filelessly
The first account was the compromised Azure AD Connector account,
such as Mimikatz
Earth Pretas Cyberespionage Campaign Hits Over 200
when .NET framework APIs are used in the code
packed into a Windows executable file
this executable is an archive that can be unpacked with the help of 7zip
use WMI to persist a backdoor and also store\nthe PowerShell backdoor code.
service is then created to run that module and is immediately started
In addition to containing obfuscated strings, the installer’s code\nis protected using various control flow obfuscation techniques that\nmake static analysis cumbersome
operators attempted to use cached credentials from local accounts to gain initial access to additional systems within an internal network.
creates the folder “C:Windows System32”, with a space after Windows
The decoded PowerShell function
advapi32.CryptHashData
Real-time screen monitoring
adversaries copied and executed the aforementioned PowerShell script on multiple systems across the environment
then starts a suspended process to perform injection on it.
DeviceControl API methods
C:\Windows\system32\cmd.exe /C
used DLL side-loading to execute their malicious payloads
WMI Consumers specify an\naction to be performed, including executing a command, running a\nscript, adding an entry to a log, or sending an email
passes the obfuscated string to a function that strips the arbitrary string and delivers the original string.
the batch file to run
then proceeded to inject into various other processes on the host (explorer.exe, rundll32.exe).
SSL can be used to complicate command-and-control (C2) traffic analysis
that hashes each running process on the system
prefix is used to hide files, directories, NamedPipes, scheduled tasks, processes, registry keys/values, and services.
the malware executes a command to delete itself from the system
Analysis on recent wiper attacks examples and how wiper malware works
ransomware uses Native API.
record keystrokes
collects local files and information from the victim’s local machine.
Gets a command to run, executes it
When the payload was executed, there were some telltale registry events observed
used to steal victims’ sensitive data.
obfuscated with FinSpy Mutator
The malware injects the ProcessWorm into all processes running on the system
now responsible for decoding the configuration.
An endpoint with a system injected
to search for sensitive information for exfiltration purposes.
looks for the Outlook data files from the victim profile’s Outlook application data folder.
can use XOR, TEA, RC4 and a modified AES algorithm to encrypt traffic and files.
they are instructed to click “Confirm” to view a message from “Express.”
stealing credentials from the Local Security Authority Subsystem Service (LSASS) process.
that uses command and control servers to collect information on compromised systems
This is a Windows Native Binary executable embedded inside of UEFI firmware binary
then decrypts and communicates to
executes, it drops a PHP application with additional files
C:\Windows\system32\cmd.exe /C
process of downloading and setting persistence of some other file.
exfiltrating data from the target device
Creating a WMI permanent event subscription
cyber actors have exploited known vulnerabilities in Internet-facing systems
the GPG-encrypted files:
This script is for executing the PowerShell script via a Windows scheduled task
--serviceService Type: user mode serviceService Start Type: auto startService Account: LocalSystem
The threat actor kept the remote desktop session alive
persists by means of a registry run key or a startup folder
logging keystrokes
threat actor is actively exploiting the so-called PrintNightmare vulnerability (CVE-2021-1675 / CVE-2021-34527) in Windows' print spooler service to spread laterally across a victim's network
acting as proxies to relay\ncommunications to their C2 servers.
the attacker leveraging Windows Remote Desktop Connections to pivot to additional systems in the environment.
executes it through the PowerShell commands.
The activity thereafter included dumps of LSASS
MoonBounce the dark side of UEFI firmware
Cobalt Strike a Defenders Guide  Part 2
a virtual private server (VPS) behind which the attacker has parked the actual command and control (C2) server
decrypting the appropriate loader
executes it using rundll32.exe
Manipulates (creates, lists, starts, stops and deletes) services.
plugins such as a keylogger,
it downloads the file from its command and control (C2) server,
enumerating current directory 
and the rar files were deleted
T1041
The C2 is constructed with the victim's enumerated data
a DLL obfuscated with VMProtect.
The server contained HTTP header data (SimpleHTTP/0.6 Python/3.8.10), indicating the use of a Python library called SIMPLEHTTPSERVER
Earth Zhulong Familiar Patterns Target Southeast Asian Firms
install an information stealer.
an encrypted configuration.
write module to the encrypted storage
Decoded CommandLineTemplate PowerShell code
to get files from drives
uses HTTP for command and control
The file that was uploaded 775E.bin was deleted by the injected ‘Explorer.exe’ process from the target endpoint
executes an export function called "Entry" from UpdateTask.dll via rundll32.exe
The message above the ‘Open’ button instructs the user to “double click” in order to receive the attachment.
tasklist
low-level API functions (such as NtEnumerateValueKey or NtQuerySystemInformation)
Batch files are used
Persistence is maintained after boot/reboot via malicious autostart registry keys.
operators used Splashtop – a remote access and management (RMM) tool – to transfer the following malware into the target’s environment.
and decrypted
and inject it into winver.exe for the next-stage payload
keylogged a user during a mandatory password change
Keys found in CurrentVersion\Run contain references to programs that will execute when a user logs in.
To avoid detection, attackers renamed Windows administrative tools like adfind.exe which were then used for domain enumeration
decrypt
downloading and executing two other PowerShell scripts from a different attacker-controlled server.
contains some junk code and data in HEX format.
Valid credentials
to authenticate to the site behind the onion link on the TOR network
whoami.exe
C:\Windows\System32\cmd.exe /C dir
IronNetInjector is made of an IronPython script that contains a .NET injector and one or more payloads.
it searches for .blf files in the\ndefault user’s profile directory
Contain an encrypted .NET injector and one or more encrypted PE payloads.
SFX archive
The decryption function is custom
and the following data is written into registry:
Logfiles on the Linux-system show traces which can be attributed to a credential stuffing or password spraying attack.
This activity group always uses a renamed version of rar.exe.
XOR-decrypts further shellcode carried within itself,
"cmd"  /c
T1566.001
C:\Windows\system32\cmd.exe /C
the threat actor accessed the environment using Tactical RMM to deploy Anydesk on the compromised host.
leveraging Microsoft’s CryptoAPI
the adversary used impacket to execute Windows Management Instrumentation (WMI) to achieve command execution on other systems present in the environment.
stored as a list of registry keys, yet we also observed a variant in which similar content was written into a TXT file.
exfiltrated over HTTP using GET requests
The mounted file contains a hidden folder
to execute encoded scripts.
injecting it into legitimate processes.
The actors used RDP to move laterally to multiple hosts on the network.
deleted the LaZagne binary after execution to avoid detection from the user's side.
VirtualProtect changes the permissions of the given virtual address.
the malware retrieves information on the infected machine and sends it to the C&C
legitimize the package in the eyes of the victim
HTTP traffic to C2
C2 is transmitted as a zip file during the POST request.
valid accounts
deobfuscation, and decompression
To the victim, the opening process simply looks like a regular directory.
The backdoor uses an RC4 key\nconfigured by an earlier stage of execution to encrypt and decrypt the\nData field
The actors could also gain access to other systems where individuals may have reused their passwords.
decryption of the payload is based on XOR operations
lateral movement scripts such as WMIExec.
the second option is used with the PID of explorer.exe to load the ComRAT payload reflectively into the process.
The domain name of the device
credential stuffing
downloads and executes
contents are unpacked
detect when TLS connections are being initiated and log the symmetric keys generated for the SSL/TLS connection
DLL Side-Loading
The only difference is that the malware replaces the thread context with the downloaded executable and resumes it afterwards.
schtasks.exe command to register the file to the task scheduler with
modifying the Local Security Authority (LSA)\nregistry key value
loader establishes a connection with a C&C server in the final stage of the attack.
the newly injected PE
can be decrypted to an active malware download server
using rundll32.exe
include the ability to collect mouse movements, keyboard activity
The attackers may use RDP to move across the network.
reading files
compress (and if it has the functionality of a crypter also encrypts) the original executable, which is saved in one of the sections of the final packed file.
payload decoder from Github
"cmd" /c
The threat actors used C:\MS_DATA as their main working directory for storing malware and staging data for exfiltration
cyber actors also used on-premises Identity and Access Management (IdAM) and federation services in hybrid cloud environments in order to pivot to cloud resources.
decrypts the payload is the same as the function used in FatalRAT to decrypt its configuration
file would execute a batch script
The malware was injected into a SVCHOST process where a driver location pointed to the config file
Once decoded
The malware will first start enumerating files in the directory it is being executed from.
launch of a suspicious batch file.
AA21076A TrickBot Malware
This function decrypts strings
it can create a service
using the FindFirstFileW() and FindNextFileW() API functions.
files were then deleted
command execution.
began their first lateral movement to a server in the environment by copying their Cobalt Strike DLL over to the host and executing it
Operating system version and whether it is 32-bit or 64-bit
a batch script used
searches for and exfiltrates the following information:\nOS architecture\nBuilt-in admin\nDomain host name\nHostname\nLocal admin\nOperating system\nScreen resolution
T1573.001
recording files to be uploaded when their download is requested by the C2 server.
encrypted using its own XOR key
command uses the Windows Management Instrumentation Command-line (WMIC)
Searches for specific files prior to encryption.
API functions.
elevate its privileges by executing the mw_UAC_bypass function
Windows Command Shell
valid credentials have been used by Vice Society to gain initial access.
created a persistence mechanism for UltraVNC by adding the\napplication to the ConhostNT value under the current users Run\nregistry key.
LSASS dump in the WebDAV detected
Service Type: user mode serviceService Start Type: auto startService Account: LocalSystem
the attackers would launch a lateral movement phase, using default Windows credentials
It also embeds a DLL version of the Pafish (aka Paranoid Fish) sandbox and analysis detection tool as one of its encrypted resources
Phishing emails spoof legitimate senders to deliver RokRAT via LNK files
running processes were reviewed
Internet-facing applications and systems vulnerabilities can be exploited, such as PrintNightmare (CVE-2021-1675) and (CVE-2021-34527), to gain initial access.
utilising similar API calls,
the local disk volumes to be encrypted are also configured in a similar manner.
a regular Bitmap (open matrix image format used by Windows) that can be used by malware to execute code or as a payload dropper
Decryption is the same across both
disabling security tools
Curl is used to download the malicious DLL file
is decoded and unarchived
passes control to a.bat.
the decompiled code used to decrypt strings
has the capability of sending additional payloads to the hosts
C:\Windows\system32\cmd.exe /C
The script checks the host against the list of antiviruses
executes an embedded PowerShell command
have adopted more obfuscation techniques
used RATs that implement UAC bypassing.
Screenshot grab
is gzip-decompressed and executed
systeminfo
Increasing The Sting of HIVE Ransomware
encrypted with the algorithm
Once it has decrypted the embedded DLL
it enumerates several known Crypto Wallet directories and looks for files related to crypto currencies by looking for files having “wallet” substring on its file name.
Checking the number of processors
 Process to inject into
DLL Side-Loading
a lot of junk code
T1106
Windows Defender tampering
extract specific information about running processes
three sections are extracted
The DLL embeds several obfuscated strings
Threat actors used the lolbin wmic.exe in order to execute PowerShell Cobalt Strike beacons on multiple workstations and servers
The current system username
encoded payload
decompress data blobs
A second config block, which is decrypted separately
abuse legitimate applications vulnerable to DLL side-loading attack.
reading/writing registry keys
due to DLL side-loading, the loader/injector winutils.dll is loaded into memory and runs in the context
the executable ieinstal.exe was used to bypass UAC.
a spoof of the legitimate ‘PerfectData’ software designed to masquerade a malicious application as legitimate
installing remote access software.
inject it into some process
Try to disable Windows Defender service “WinDefend”
designed to stop Cisco AMP.
by compromising a web-facing application such as Microsoft Exchange or SharePoint
Malware immediately decrypts the third layer
String decryption for the DLL names needed for execution.
Decryption routine
Manual interactions are required
Upload a recording file with a specified name to the C2 server.
command-line tool
to decode the second buffer using key 58 3E 88 D0
Legitimate processes have been corrupted by Vice Society via code injection, as a means to evade defenses.
hardware information.
Command execution
The injection is also visible from memory dumps
dumped lsass memory on the domain controller.
It checks for the number of processors in the infected system
Decrypts
entry point of the original file is relocated, and so is the Import Address Table (IAT).
It checks that the status of certain services belonging to security-related software meets certain conditions (e.g., windefend, sense, cavp)
service was installed in the system
exfiltrate contacts’ email addresses
The computer name and the username is also sent to the C2.
CVE-2018-12613, a phpMyAdmin vulnerability that could allow threat actors to view or execute files
then downloads its payload via software installed on the compromised device, such as ftpget, wget, curl, or tftp, before executing the payload.
The actors manually disabled Windows Defender via the GUI.
contains shellcode and an embedded DLL file that loads FatalRAT
which stored credentials in a database file.
which prompted DC authentication to the SharePoint server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT
keylogging
The malware will continue to read and decrypt goopdate
keystroke
Threat actors obtained and abused credentials of privilege domain accounts
the given task the downloaded file
samples have used HTTP over ports 447 and 8082 for C2.
gets executed via the “SHELLEXECUTE”.
downloading
has operated sites on the Tor network using the following .onion
The DNS request for the initial host resolves to a Cloudflare-owned IP address that allows the attacker to employ domain fronting and send the traffic to the actual C2 host
JavaScript is the module that has to be manually executed by the victim,
execute an encrypted payload located in the embedded DLL
a payload download code that grabs malware to download and install the backdoor.
PowerShell downloading malware
showing the “uninstall” commands for Windows Defender:
cyber actors used RDP
Delete file
creates another batch file, system.bat,
Process dump of the LSASS process
The content is encrypted using AES CBC with random 16-byte keys and IVs,
HTTPS and other protocols built on SSL have
request access level of 0x0040 (64) to LSASS, as well indicating other credential access tools may have been in use by the threat actor.
The decrypted payload
by creating immediate tasks through GPO.
via ZwMapViewOfSection calls
performs a BXOR to decode the bytes
Uses GetComputerName to query the computer name.
wrote the encrypted and base64-encoded PowerShell\nbackdoor code
Contains the imported unmanaged function declarations and win32 structures/constants.
modifies the registry
using the callback function pointer in CallWindowProc
adversary leveraging a Windows Service to execute PowerShell to stay persistent in the environment.
is implemented via NtSetInformationFile using FileInformationClass FileRenameInformation,
calls the NtProtectVirtualMemory function where the NewAccessProtection argument is PAGE_EXECUTE_READWRITE and the BaseAddress argument is an address to a library function
the user clicks on the malicious link or opens the attachment.
accepts commands from a Telegram channel,
the threat actor moved on to downloading a variety of beacon executables
use process hollowing to inject decrypted payload into child process and resolves its Import Address Table.
HTTP and HTTPS are supported
This Windows executable is embedded into UEFI firmware
The malware then proceeds to decrypt its configuration block,
In the main thread the SFX/ZIP file is executed/decompressed,
decrypt its configuration strings
of mstsc.exe being executed after being injected with malware
logs keystrokes
Returns the path to the user’s temporary folder.
is injected into all running processes.
WMI Persistence
If the API fails to execute, the malware calls InitiateSystemShutdownExW
initial code usually called a stub, decrypts or decompresses the real code
WMI provides many administrative capabilities\non local and remote systems, including querying system information,\nstarting and stopping processes, and setting conditional triggers.
wmic  /node
There are two approaches to using valid credentials to copy and execute the malware to a remote host:
Microsoft Outlook Messaging API (MAPI) module
uses PowerShell to pull and run
API obfuscation, and execution flow obfuscation
to install AnyDesk and provide remote access for the “technician” to install the malware.
downloads and executes
backdoor that is capable of executing commands
determine if it is running as an account with administrator privileges or simply as a regular user
into the folder c:\programdata
the JPEG decoy file
received a command-line argument from attacker
more obfuscation and encryption techniques that lead to the final payload.
stored between data xml tags (<data>%version%</data>) of the response from the service
executing a batch-file (.bat) to perform their tasks.
The email text employs scare tactics, such as evidence of a traffic violation, prompting the user to open the HTML attachment
used various RATs that exfiltrate data over the same channel used for C&C
User execution [T1204] of malicious files
the Windows payload was named “IntelUpdater.exe”
common native Windows tools and commands such as netstat
archive contains the files,
Threat actors performed the first lateral movement from the beachhead to the server using RDP with an Administrator account
Attackers may attempt to access LSASS process memory to extract credentials as it stores a variety of credentials.
Keylogging
Download components for the Keylogger
It is a key logger that saves data in the “KeyLogs” folder.
to execute Procdump, which was used to dump lsass.
Is able to steal/gather information on CPU type, screen resolution
has keylogger functionalities
deletes its rootkit’s executable after launching it.
utilizes the same Common Name in their TLS certificate.
deletes them from the original location.
AA21200B Chinese StateSponsored Cyber Operations Observed TTPs
enumerating the child files in the check OneDrive subdirectory.
UAC Bypass via the AppInfo RPC service
The use of RDP was extensively used throughout the intrusion, using a variety of processes
delete its process file
bypass user account control (UAC) using only two remote procedure call (RPC) requests
PE reflective injection.
After resolving the functions
created a Scheduled Task
OS version and system type
first interfered with security tools using Group Policy Objects (GPO).
After decrypting
downloads Security Shellcodes from the C2 server
that pulls the written data from the registry under HKEY_CURRENT_USER\Software\AppDataLow\Software\Microsoft\<registry_value>>
Below is an example of the service edc603a that was created
which perform asymmetric/symmetric encryption of the C&C server communication channel.
utilizes legitimate programs to side-load the group’s own DLL to execute their payload.
a PowerShell script block was executed\nto download
critical APIs
downloaded from the C&C along with the ModScan module
is a legitimate AutoIt interpreter.
configured to run the payloads in the startup folder of the victim’s machine
antivirus check script
This file is base64 twice,
wmic
can obtain passwords stored in files from several applications such as Outlook, Filezilla, OpenSSH, OpenVPN and WinSCP.
get decoded and decrypted
the decoded command line parameter
recon for interesting hostnames
contains the payload DLLs and a few legitimate executables and DLLs
such as schtask or crontab to create and schedule tasks that enumerate victim devices and networks.
The base64-encoded strings were plaintext again in this version.
its C2 server every five\nseconds via HTTP POST requests.
POST request with push operation
Uses Mimikatz to harvest credentials.
injects the ProcessWorm into processes
decrypts the array by doing a single-byte XOR operation, cycling through the key
via a Windows batch script file
This file extracts credentials from LSASS similar to Mimikatz.
which were previously encrypted
decrypting
service was installed in the system
Deja Vu All Over Again Tax Scammers at Large
used UltraVNC to download an in-memory dropper
an extracted JS script
variety of packers used for these executables
Manipulate files and directories (list
CreateFile and WriteFile are used
wininet.HttpSendRequestA,
attack of a Remote Desktop Protocol on a public-facing server.
kernel32.CreateMutexA
and hostnames collected
Warning New attack campaign utilized a new 0day RCE vulnerability on Microsoft Exchange Server
UAC Bypass via the CMSTPLUA COM interface
starts a hidden file in the directory
Returns information about the machine’s BIOS.
After the strings are decrypted
ViperSoftX Updates Encryption Steals Data
sending an HTTP Post message
communicates with the C2 server specified in the configuration via HTTP or HTTPS POST requests
The configuration is stored as a base64-encoded blob, whereby the first 16 bytes of the base64-encoded blob is the RC4 key
the adversary achieving credentials access by brute force
Decompressing
Execute commands via Command Prompt
Besides the use of Mimikatz to dump credentials,
to load an assembly into an unmanaged process.
a tool called “anti.exe”\nto stop Windows Update service and terminate EDR and Antivirus\nrelated services.
Returns information about the operating system
The batch file name
a separate service was created for that agent.
Defending Users NAS Devices From Evolving Threats
sending additional phishing emails to the victim’s contacts
func_GetProcessor()
decompress and decrypt the final payload
The fernet_decrypt function decrypts an encrypted string
WMI activity [T1546.003] was also observed to execute commands on the systems.
Windows net commands were run,
a malicious batch file with a .cmd extension is downloaded to the user’s machine.
Creates a scheduled task to be executed with d as an argument 
a service that launches the moved executable rc.exe with one parameter.
Before the decryption starts
Deobfuscated HTA content
which initiates the payload download
persists on infected machines by creating new services
The PE file is downloaded on filesystem and than executed.
Registry Editor
cyber actors used valid accounts to log into a service specifically designed to accept remote connections, such as telnet, SSH, RDP, and Virtual Network Computing (VNC).
will make a POST request
used emails with PDF or RTF files attached that contain a link to download malware
the API Web RESTful that provides access to Microsoft Cloud service resources.
attempted to masquerade dropped files as legitimate Microsoft Windows executables
the group used certutil.exe to download the legitimate WinRAR binary as rar1.exe from the server
Manipulate files and directories (list, download, upload, view, delete
performing remote directory listings.
several Windows API functions are resolved using GetProcAddress
through legitimate remote access software such as AnyDesk
enumerates their partitions.
implanted Ngrok reverse proxies
to enable offline password cracking.
two TCP connections.
to decrypt the configuration file.
T1003.001
Base64 encoded string with several string replacements.
the malicious attachment,
Recording keystrokes in real time with offline logging available
to fool potential victims into opening them.
is another example of custom malware used for packing files;
task scheduling
Then it enters a for loop iterating over the drive list to build a recursive directory listing
using the clfsw32.dll API function
The threat actor used both privileged and non-privileged accounts for RDP throughout the environment, depending on the target system
deleting files
the command line provided to the ransomware is parsed.
downloads a payload
the decrypted\npayload contents
payload and intermediate library are deleted before completion
The redirectors used HTTPS reverse proxies to redirect C2 traffic between the target organization’s network and the Cobalt Strike team servers
can disable Windows Defender.
can obtain passwords stored in files
they suspend the remote process threads
collect the victim’s login credentials for various online accounts
hostnames
tool can be used as a persistence mechanism and remote accessing
shellcode that was stored in the .data section is now stored in the .rsc section
the decrypted payload
To establish persistent remote access on the victim device, the threat actor abused Windows services to install modified version of Cobalt Strike payload
encrypted header
The threat actor regularly interrogated other systems using tasklist.exe
the folder C:\Users\Public
creating a hash for each export function name
The ProxyShell elevation of privilege on the Exchange PowerShell Backend (CVE-2021-34523), Windows Background Intelligent Transfer Service (BITS) improperly handling symbolic links (CVE-2020-0787), and abusing the CMSTPLUA COM interface have all been seen as methods of privilege escalation.
download files from an attacker-controlled bucket in Alibaba Cloud
service was configured to execute the next step of the installation process by running a legitimate application
sends emails pretending to be related to a shipment notice for the target which contain a malicious attachment.
Deletes the WinDefend service
invoked from the command line
and the built-in Windows user account DefaultAccount [T1078.001] to move laterally
Usernames
obfuscated with SmartAssembly
This lures users to double-click the graphic to view the content,
Sending and receiving data with C2 using the RC4 encryption algorithm where the key will be generated at runtime.
SFX archive
Right after its execution, the wab.exe process created two remote threads in order to inject code into explorer.exe and rundll32.exe:
CMD-based scripts
and injects Qakbot into wermgr.exe.
System Information
Domain fronting uses legitimate or high-reputation domains to remain undetected by defenders.
the user will continue to execute the dropper
the threat actors were observed using compromised credentials to access the Azure AD Connect device.
base64-encoded argument
retrieves the MachineGuid of the infected system from the "SOFTWARE\Microsoft\Cryptography\MachineGuid" registry key.
Data view of the section containing the encrypted malware.
to search and identify accessible volumes on the targeted system.
the scheduled task will trigger 30 minutes after the malware execution.
resolves hashed Windows APIs
systeminfo
HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Monitoring\DisableIntrusionPreventionSystem \nDeleteValue 
T1071.001
used RATs that can launch a command shell for executing commands.
It uses bat files
To determine the command and control (C2) servers waiting for the data to be sent to, the malware calls a decryption function that uses the RC4 algorithm
the malicious actor retrieved system administration tools and malicious payloads by using the Background Intelligent Transfer Service
An instance of cmd.exe was launched through explorer.exe which ran the following command
cmd.exe /C rundll32.exe
To remotely access the compromised infrastructure, the attackers may use the legitimate tools TeamViewer and ScreenConnect.
This script called a combination of QueueUserAPC, GetCurrentThreadId, OpenThread, and VirtualAlloc
The algorithm used for the buffer decryption differs across the samples.
archive contains a bait PDF document
use AES-128 in CFB mode as the encryption algorithm
they decrypted the cookies file using the user’s DPAPI key.
looping through entries under registry key
decrypted Ransom Cartel configuration
Attackers can use legitimate domains that are registered under the same CDN provider.
Monitoring file system events to collect new and modified files.
the initial vector used by the threat actor was a zip file, which included a malicious JavaScript file, delivered through a phishing campaign.
they use tools such as Mimikatz to dump credentials.
encrypted with XOR and compressed with aPLib.
This service has the highest privileges that can be abused for Windows 10 UAC bypass.
the DLL will find the address of an export function called SVP7, which contains the entry point of the malware,
invoked the wave 2 ransomware immediately from the command line
This packer has been around for many years
PsExec has also been used to aid lateral movement
The BAT script
delete itself from the target systems after infection
The padded i2pd Mach-O file
zip archive
The paths and registry keys to use
C:\Windows\system32\cmd.exe /C
. The malware will try first to write in the registry-hive “HKEY_LOCAL_MACHINE” but if it cannot create it, it will use the registry-hive “HKEY_CURRENT_USER”:
takes screenshots at regular intervals.
establishes persistence through the creation of two keys in CurrentVersion\Run.
an encrypted configuration file
T1140
the threat actor injected into various processes
After bypassing UAC
compressed binary
This enables the operators to setup a listening port and leverage it to relay traffic to and from the open beacon session
These encrypted strings,
WMI was used to pivot to a domain controller on the network.
deletes it as soon as the utility is running
decrypted, and executed the backdoor code
use system calls
using a batch script
can be found in the two bytes of the HTTP payload
It created a Run key in the Registry
Threat actors used Atera and Splashtop remote access tools on two compromised hosts during the intrusion.
This adversary starts with obtaining usernames
multiple levels of encoded commands,
uses AES for encrypting traffic in its backdoors
These batch scripts’ purposes
the installation of the remote management tools
removing files from the system.
Local IP address and port used to send the network packet
the attacker was observed moving laterally to\ndifferent systems in the environment using Remote Desktop Protocol\n(RDP) connections.
to download the XMRig payload.
injected into
Evasive Process Hollowing by Entrypoint Patching
the encryption key for sensitive data
bat script:
searches the system for all of the following file extensions: .avi, .mov, .mkv, .mpeg, .mpeg4, .mp4, .mp3, .wav, .ogg, .jpeg, .jpg, .png, .bmp, .gif, .tiff, .ico, .xlsx, and .zip.
uses PsExec to modify the system registry parameter MaxMpxCt
APLib decompression function
encrypted resource and XORed with a hardcoded password
The team cracked a user’s workstation account password after learning the user’s patterns from plaintext credentials.
HTTP POST request (type 27 / data exfiltration).
likely exploited known vulnerabilities in unpatched applications for initial access
Abusing cloud services to fly under the radar
malware hidden inside the Python compiled byte code
decrypting the payload
This module allows the injection of a PE file into a remote or local process’s memory without writing it to disk
after the user clicks on the malicious link or opens the attachment.
retrieves the same files from the C2
added an exclusion rule to Windows Defender.
compression using QuickLZ
this includes VPN accounts
Scheduled Task Creation or
to decrypt it using AES GCM algorithm
The malicious side loaded DLL
wmic  /node
The code in the injected PE
Upload, download
the SMB Beacon is communicating over the network with a parent Beacon using named pipes.
Dissecting One of APT29s Fileless WMI and PowerShell Backdoors POSHSPY
Keylogger Deployment
calling an export function of the DLL
connect to a certain URL every 60 minutes using the normal Windows file mshta.exe.
the actors gained access to a VMware service account with administrator and system level access
FinSpy unseen findings
placed in a hidden directory
Use NtQueryInformationProcess API
The script will download and decrypt the string that represents the token
launches a slightly modified Metasploit Reverse HTTPS stager
It also deletes the ransomware, script file, and ransom note (index.html), ensuring that no evidence remains on the compromised system.
the domain fronting functionality before launching the attack.
LoadLibraryW, VirtualAlloc, CreateProccessW, and ZwUnmapViewOfSection.
Exploitation for Privilege Escalation
AA22320A Iranian GovernmentSponsored APT Actors Compromise Federal Network Deploy Crypto Miner Credential Harvester
Crosswalk and Metasploit injectors
a Windows task XML to start
has utilized a UAC bypass tool.
continuously captures keystrokes
data is encrypted in the standard way
The malware generates a random 32-byte key, which it encrypts using the RSA key.
When decoded, the content of the Ir8 variable (a segment of which is shown below) turns out to be just another encoded PowerShell script, which the VBS decodes and then executes.
the decrypted content
KCP protocol
Disables Windows Defender Attack Surface Reduction (ASR) rules
WMI
registry run key persistence implementation
that makes the HTTP request.
the malware creates 2 scheduled tasks
injected into notepad.exe, where the ransomware logic begins.
Threat actors used two scripts named s.bat (for servers) and w.bat
the data was stored in a location in the Internet Information Services (IIS) web server and exfiltrated over HTTP using GET requests towards the exact file paths
Capture the screen area around mouse click locations
affiliates may exploit group policies, which results in a scheduled task being created (on each host) that launches the ransomware.
indicating the use of Remote Desktop Protocol.[
evade detection
a method of lateral movement and a tool for downloading/executing files.
These strings are passed to a\nde-obfuscation function
create a scheduled task
With this list of administrator-accounts, the adversary performs another password spraying attack until a valid admin account is compromised
A local account was used by the Threat Actor
enables the TAs to create customized documents containing embedded objects that exploit vulnerabilities in Microsoft Word’s Equation Editor
uses a custom network protocol, which can function over HTTP
performed via the following command-line syntax
keylogger with logging capabilities using the Telegram API
brute forcing post-infection to automate local and global spreading attempts.
threat actors remotely dropped AnyDesk binary on a server from the beachhead:
pc.exe decrypts AddSecurityPackage64.dll and pc.dll using the AES encryption algorithm
cyber actors used the Server Message Block (SMB) protocol to import tools into victim networks.
we find an XOR loop
Inside the Mind of a Cyber Attacker from Malware creation to Data Exfiltration Part 1
the embedded Windows executable
func_GetLanguageTimeZoneOsVersion()
access to system APIs,
Name of running module\nPID
Mimikatz – a credential theft tool.
obtained the credentials of a domain administration at headquarters
DbgBreakPoint and DbgUiRemoteBreakin API
consistently cleaned up evidence of their intrusion after\ngaining access to a system
highly obfuscated and contains junk code to impede analysis.
It then sets registry entries
Access to valid
the group crafts bespoke phishing emails, often purporting to contain information on security policies that affect countries in the Middle East, to deliver weaponized documents to individuals of interest.
creates a scheduled task on the system that provides persistence.
the threat actor connected to the victim’s O365 tenant
added to the startup folder
The actual bytes of the decrypted shellcode
the new drive contained a LNK file 6570872.lnk and hidden folder “me”.
TOR sites redirecting to a new ransomware operation
leveraging Windows Management Instrumentation (WMI) to identify the system’s manufacturer.
base64 encoded with some string modifications
Akira Ransomware is bringin 1988 back
Remote Desktop Protocol (RDP), and the threat actor was able to move freely across the network
C:\Windows\system32\cmd.exe /C gpupdate 
to gather basic system information.
This first lateral movement was performed in order to drop and install AnyDesk.
checks for the names of the following antivirus vendors: Sophos, Kaspersky, Avast, Avira, Bitdefender, TrendMicro, and Windows Defender
Evasive NoEscape Ransomware Uses Reflective DLL Injection
leverages a custom packer to obfuscate its functionality.
Setup a profile to facilitate domain fronting
It supports proxy (Socks5),
injecting a PE executable
also supports command-line arguments,
Downloads the miner and watcher.
Bash script
“Who and What Threatens the World (Column).exe” and is designed to deceive users by using an icon that is similar to that of Hancom Office.
is injected into one of the processes specified by the C&C
The decryption algorithm
Decryption function
drops and executes Cobalt Strike in the memory space of “rundll32.exe.”
reg.exe query
The authors cleverly utilized these legitimate dependencies via symbolic links when dynamically creating the legitimate bundle in the temp folder.
which decrypts to the following 5 bytes
do rundll32.exe C:\windows\System32\comsvcs.dll,
backdoor is a basic remote shell
when the victim clicked on the LNK file, it triggered the execution of the batch file
wmic  /node:<
Cobalt Strike beacon acts as the intermediary to facilitate the Remote Desktop session
Encrypting communications using AES and RSA public key cryptography
Credential and Browser Data Theft
strategy to persuade the victim to execute the malicious shortcut file
archive was distributed
cmd /C
the ransomware to deploy additional tools
cmd /C
It contains a very similar function dedicated to decrypting and loading the final payload
an encrypted shellcode payload.
service using HTTPS
loaded with VirtualAlloc and executed
the embedded files in the scripts
shellcode injection
the payload which will be\ndecrypted.
RAR file contains a batch file with a CMD extension
there is indeed some sort of unpacking happening.
File deletion functions
malware creates the persistence via Registry Run Keys.
to establish a Remote Desktop Protocol (RDP) session to an internal server
identify the architecture
Get the total RAM size of compromised host by executing "SELECT * FROM Win32_OperatingSystem" and look for "TotalVisibleMemorySize"
WMIC
to mirror all directories found in /Applications/Logic Pro X.app/Contents and /Applications/Logic Pro X.app/Contents/MacOS to their respective /tmp/ locations
ROR-13 hash
continues to use older vulnerabilities, especially Log4Shell, to compromise unpatched devices
cloud drive, or other cloud resources accessible by the compromised account.
C:\Windows\system32\cmd.exe /C dir /s *file/
decoded by Shellcode
downloads the next stage from a public file storage service
the actor executes Cobalt Strike’s built-in Mimikatz to dump its credentials or password hash
uses other tools to gather credentials that include Mimikatz, LaZagne, and NirSoft’s NetPass.
The actors used RDP to move laterally to multiple hosts on the network.
Modifies the Registry to disable UAC remote restrictions by setting SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy to 1.
heavily obfuscated with random symbols that substitute the instructions during the run-time and base64-encoded strings.
encrypted shellcode’s file
containing obfuscated PowerShell scripts
domain fronting
was to start a program as a service
obtains the IP address, location, and other relevant network information from the victim’s machine.
the threat actors dropped Powertool64.exe and dontsleep.exe in preparation for their final actions.
The model uses the persistence technique utilizing svchost.exe with service.dll to install a rogue service.
AA21200A Tactics Techniques and Procedures of Indicted APT40 Actors Associated with Chinas MSS Hainan State Security Department
is a known indicator of such tools as Mimikatz
opened it would initiate the download of a batch (.bat) file.
The tool allowlisted the entire c:\drive, enabling the actors to bypass virus scans for tools
systeminfo
gathers username and computer name from victim machines and reports them to the C&C in initial message.
The batch script will delete the malware sample with its path using the command “del” and finally delete the bat file with the command “del %0%”.
Tailoring Sandbox Techniques to Hidden Threats
Retrieve TCP/UDP tables
A block of base64-encoded, encrypted data comprises almost 150KB of that script,
or unpack the final payload
disables AMSI by hijacking the COM server, changing it from "%windir%\system32\amsi.dll" to "C:\IDontExist.dll".
This threat actor abused access to accounts in the Cloud Solution Partner’s environment with legitimate delegated administrative privileges to then gain access to several customers’ O365 environments
CreateProcessAsUser or CreateProcess is executed,
obtains the device’s local and external IP address.
the key that will be used for the decryption is prepared.
Internet information,
The malicious code is written into the newly created process and the suspended thread context instruction pointer is changed using NtGetContextThread/NtSetContextThread.
covert channel that can be used to exfiltrate data from the victim device
use API calls such as VirtualAlloc to load and execute malicious components into memory
The actor may then perform actions as the logged-on user.
a JPEG decoy file are dropped
can communicate over HTTP or via its “normal protocol”.
brute forcing attempts on some of the internal FTP servers inside victim network
the malicious authentications into victim O365 tenants had originated from within the victim’s own network.
The malware checks if there are monitoring tools, specifically Process Monitor, running in the current machine with the following strings:\nprocmon\nprocmon64\nprocmon64a
download further malware payloads
threat actor used the Windows command-line arguments
we identified numerous legitimate applications backdoored
Username
proceeds to decrypt
The actors’ exploit payload created Scheduled Task
malicious oci.dll into the service’s executable
The adversary heavily relies on scheduled tasks for executing a batch-file (.bat) to perform their tasks.
its shell open command.
Commands are used to download and install plugins
The packer decompresses and executes
Keylogger
subsequently download Remcos on the target system
to terminate security-related processes and services by dropping KILLAV
cmd /C "C: & cd \ & tasklist"
“cmd” /c
The script first deletes itself from the disk.
including API hashing and execution flow obfuscation through exception mechanism
to report some basic information about the compromised system
The batch file would download and execute
Afterward, the shellcode will then decrypt and load the main ViperSoftX DLL embedded within the carrier.
Persistence for the RAT is achieved via registry entry, and a shortcut to the installed RAT executable is written to the Startup folder.
the threat actor leveraged different credentials for each step while moving laterally through the victim’s network
download, and configure
get a pointer to the encrypted shellcode and to decrypt it have been broken out into their own separate functions
password-protected executables to obfuscate malware
starts by decrypting its initial configuration data
to locate certain files, paths,
brute-forcing and compromising servers
designed to lure unsuspecting victims into executing the loader.
Once the working directory is prepared,
The image’s pixels are an actual binary representation of the payload.
reg.exe ADD\nHKLM\SYSTEM\CurrentControlSet\Control\Lsa /v\nLimitBlankPasswordUse /t REG_DWORD /d 1 /f
Leveraging a dual-use tool, PCHunter64, to acquire detailed process and system information.
Returns ProcessDebugObjectHandle value returned by NtQueryInformationProcess for current process
creating the files and registry keys
uploading and downloading files
Horabot campaign targeted businesses for more than two years before finally being discovered
performed through the CryptUnprotectData API function
It also checks the victim’s hostname
UAC bypass is executed
Decrypts
located in the data sections
batch files
computer name, domain name, locale and product name.
finds the relevant syscall numbers for NT APIs,
backdoor that supports commands, including screen capture
Disable the Windows firewall, using netsh.exe
Inject and execute DLLs
utilize Splashtop to transfer netscan.exe, netscan.lic, netscan.xml, newuser.bat, start.bat and turnoff.bat.
Heavy obfuscation in a simple but useful anti-analysis approach makes it difficult for security products to detect their scripts.
constructs an email with a hardcoded subject and body and attaches the HTML file from the “fb” folder.
decryption of credentials
the command line argument\nprovided
The threat actor was observed process injecting into legitimate process
to load the final payload into memory from a Registry value without
UAC bypass is executed via token manipulation.
executables attached to its phishing e-mails have an extension hidden by default by most Windows deployments (.cmd, .scr, .com, etc.).
Use a previously compromised workstation admin account to upload and execute a payload via SMB
replacing an early call instruction to their malicious code, or by overwriting the entry point in the PE header
Initial access to targets is obtained by exploiting vulnerable internet-facing applications such as Microsoft Exchange,
injected first,
With the binary named to masquerade as a legitimate file on the system
Decoder routine to decrypt the beacon DLL.
strongly indicates that it contains another component that is dropped/loaded.
The threat actor primarily focused on exploiting four different remote code execution (RCE) vulnerabilities to target web services
spawns it with the rundll32.exe command with the payload URL
a batch file
The module creates a new process using the same executable and performs process injection on it, redirecting the existing thread to the written code region.
obfuscated PowerShell
Some of these nodes operate as part of an encrypted proxy service to prevent attribution by concealing their country of origin and TTPs
WMI\ncan be accessed using a variety of tools, including the Windows WMI\nCommand-line (wmic.exe), or through APIs accessible to programming and\nscripting languages such as PowerShell.
SMB copy and remote execution
using Windows CryptProtectData() API.
enumerate files and registry keys
resulted in confirmed compromises of internet-facing Federal Government agency systems.
The initial attack phase involves infiltrating Internet-facing Microsoft Exchange servers
screenshots
Data from Local System
using LNK files to download malware or other malicious files by leveraging legitimate native apps, such as PowerShell.
generating a script to decode the legitimate Mach-O file.
reusing multiple code chunks from DEP-allowed memory pages, called ROP gadgets.
obfuscated code
stealing sensitive data from the victim’s networks.
API hashing
SYS01 Stealer Will Steal Your Facebook Info
spread the malware laterally across a network by abusing the Server Message Block (SMB) Protocol.
will check if the running processes
its attempts to steal credentials and browser data.
mining proxy.
the computer name and the domain of infected system.
ITG10 Likely Targeting South Korean Entities of Interest to the Democratic Peoples Republic of Korea DPRK
data to be exfiltrated to the C2 server
previously written Base64 file
XOR encrypted with a 16-byte key
Retrieve the user domain name, username
German users targeted with Gootkit banker or REvil ransomware
obfuscate the execution flow of the program
Fork in the Ice The New Era of IcedID
creates two other malicious batch scripts with the extension .cmd in the folder “/Users/Public.”
ransomware attempts to decrypt
File deletion
exfiltrates data to Google Drive storage
sets a hardcoded list of system directories
decoding the base64-encoded content,
stage the execution of additional plugins in memory,
then decodes and executes it.
that is abused to side-load a malicious DLL
hostname, operating system name, OS version, username,
deceive the user into thinking that the application has failed to execute, even as it silently continues the malicious execution in the background.
These files were transferred to the domain controller over SMB.
a successful sign-in to the Microsoft Azure environment was observed.
SMB exploitation via EternalBlue
multi-layer obfuscation
The download is done directly from the NetWalker Tor site
using Windows Command Shell to execute the initial dropper.
opts to obfuscate their ransomware much more heavily
The malware only targets fixed drives on the system.
utilizing the “rundll32.exe” command
directory listings were harvested as a result.
Whos swimming in South Korean waters Meet ScarCrufts Dolphin
proxy
Self-decrypting DLL
As long as the dropper successfully launches its legitimate application
emails have a PDF document attached
scanning files in a specified or generic path
Injecting credentials into LSASS memory
data exfiltration of sensitive information
DeviceControl API methods
NetServerGetInfoto retrieve the current configuration
C:\Windows\system32\cmd.exe /C
rasomware deployment to all hosts over SMB.
the threat actors began to review sensitive documents
Establish a session that originates from a target Workstation system directly to an external host over a clear text protocol, such as HTTP.
It does this by decoding the rss.txt into an executable
data that will be decrypted
running commands
the username
retrieving malware from C2
the rootkit’s DLL that is embedded as a resource
T1047
script extracts two separate binaries from the base64 encoded text
establish C2 connections via a peer-to-peer network of infected hosts
the running processes using  CreateToolhelp32Snapshot and  Process32Next
Injecting NETONLY credentials into LSASS process memory
Named piped are commonly used by Cobalt Strike perform various techniques.
list of connected disks and starts recursive traversal of directories
This shellcode has complex obfuscation, consisting of junk code
manipulating of registry keys
encrypted configuration
The actors were able to proxy [T1090] RDP sessions,
Configured for WMI persistence
This version of CEIDPageLock has VMProtect, which makes analysis and unpacking difficult
actors gain initial access through exploiting public-facing applications 
which can check running processes against a hardcoded list
used Remcos RAT, which uses RC4 for encrypting C&C communications
command-line syntax was observed being used
adds a custom icon to the registry,
transfers them to the C2 address
extracts email addresses from the emails’ sender, recipients, CC and BCC fields.
executed the "tasklist /SVC" command to list all running processes on the victim device.
The persistence technique is simply adding a run registry key for persistence
obfuscation of the GuLoader shellcode and payloads
DLL decryption routine
or download additional stages.
sets up its working directory
The phishing email with the malicious attachment
Malware Analysis LummaC2 Stealer
Once downloaded and executed, the malicious installer copies its compressed files into a newly created folder with a legitimate-looking name  (i.e., IIS Application Health Monitor) in one of the following directory paths:
and uploads it back to the server.
Windows Batch file
the installer opens and decrypts the\ncontents of the file passed as an argument
the win32 function CreateServiceA was used by the malware in order to create a remote service over RPC on the server.
that all three intermediate C2 servers
The actors used Mimikatz
the download and launch of a suspicious batch file.
executes a PowerShell command
Process manager (browses and terminates processes)
ZeroDay Vulnerability in MOVEit Transfer Exploited for Data Theft
Uses AnyDesk to remotely connect and transfer files.
Users downloaded and executed the team’s initial access payloads after clicking buttons to trigger download and execution.
includes both an encrypted payload and shellcode
Detect and Identify source IP
to load a binary into memory that injects
logs keystrokes for windows with titles containing substrings specified in its configuration
operators install and execute remote access tools such as Splashtop on targeted systems.
Hungry for data ModPipe backdoor hits POS software used in hospitality sector
used a compiled remote desktop malware,
login credentials
using the Microsoft Graph API
leverages SOCKS5 proxies to hide malicious traffic
the reverse SOCKS proxy activity on the infected device using the open-source tool FRP.
reads data from its own resource section and decrypts a payload.
The configuration is encrypted with a hardcoded DES key and is a few bytes long
enable RDP connections.
new encrypted shellcode
The beacons are of particular interest due to the domain fronting technique using a government host as the initial DNS lure.
The API function located at the beginning of the memory section are resolved using GetProcAddress
file was concealed beneath the "open" text which, if clicked, executed the HTA file.
malware exfiltrated data towards a C2
scripts are obfuscated to prevent easy detection.
The payload, usually shellcode, is injected into another process.
and then self-deletes.
The shellcode is stored in the registry,
The decryption function
C:\Windows\system32\cmd.exe /C
an embedded file gets executed by the user
GetTokenInformation API.
to discover information relating to the user
exploited Microsoft SharePoint servers in 2019 to gain code execution, probably by leveraging CVE-2019-0604
T1190
to crawl through different paths in the system
http/https data transfer
will check if the process avp.exe exists.
with username set to the built-in dba and a hardcoded password, which is potentially the default password in some RES 3700 POS versions.
credential extraction tool Mimikatz
Covers its tracks by overwriting the code previously modified by the malicious library with a useless call to lstrlenW.
GetComputerName API
It uses the win32api.GetDiskFreeSpaceEx() function
remotedesktop mode = enable cmd
or command line interface tools
to a side-loading vulnerability that
the attacker's C2 via the HTTP POST method.
the encrypted payload
When the user double clicks or opens the lnk file,
Detect and identify source IP
Decryptor download
legitimate WMI persistence
then a malware downloader is uploaded to the device
collects information about the .NET Framework Setup
SMB Copy and Remote Execution
An encrypted resume
SFX archive
SysUpdate and HyperBro backdoors were installed
use VMProtect or custom packers for its malware
using NetWkstaGetInfo() API.
The services running on the compromised system are checked against the following list
using login credentials from what the company suspects are past data breaches from other companies
in a specified separate process that is created and injected.
and only decoded as needed.
Decrypted REvil configuration
obfuscated PHP code (again using character code obfuscation):
encrypted
perform a\nnumber of changes on the filesystem or registry,
be injected with deceptive credentials at multiple places like LSASS process memory
performs the injection and execution of the payload
ipconfig /all
both use batch files that run via the Windows command shell.
exploits known vulnerabilities in internet-facing applications
packaged into an obfuscated PowerShell batch file
Second-stage legitimate executable for DLL sideloading
Mimikatz publicly available code (top); strings from a Mimikatz modification
It collects the victim’s username
phishing email
decoded command
NBTScan for network reconnaissance
to execute the Mimikatz commands ‘privilege::debug sekurlsa::logonpasswords “lsadump::lsa /patch”‘ in-memory
Threat actors also dropped procdump.exe and procdump64.exe on multiple workstations remotely, dumped LSASS,
The actors removed malicious file mde.ps1 from the dis.
each string is therefore\nencrypted with a unique byte stream.
the threat actor used private proxy addresses from a Chinese underground proxy IP solution called 'Tigercloud Club' to conceal their real IP address.
Drop and execute the legitimate installer in C:\Program Files\Common Files (see CommonFiles64Folder).
It will read the next stage payloads, free.plg and main.plg, and inject them into dllhost.exe.
Downloaded VBScript and PowerShell
was hiding in non-malicious code,
malleable C2 profiles are configured to allow domain fronting using the Fastly and AzureEdge CDNs
Username and workgroup
It checks running processes for executables of several known cybersecurity vendors.
hid the installer for Advanced Port Scanner within Inno Setup installer to evade static signature detection.
It is encrypted with a 256-byte RC4 key.
with the API function IsWindowVisible.
Returns ProcessDebugPort value returned by NtQueryInformationProcess for current process.
Computer name\nName of running module\nPID
starts with an income tax-themed phishing email written in Spanish, disguising itself as a tax receipt notification
del
when the malicious Word document opens it fetches the next payload from the remote server:
deobfuscates
A scheduled task was then created using this same DLL.
Once the malware has de-XOR’d all its strings, it invokes a method named go.
the\ncontrol flow obfuscation.
module uses HTTP and port 80.
to persist in target environments and deploy additional tools.
named after legitimate utilities are written into the %ProgramFiles%\MSBuild\Microsoft\Expression\Blend\msole\ subdirectory.
once decrypted, contained the C2 domains for additional malicious artifacts.
loading an encrypted payload from its resources
Creation of syscall table for certain NT APIs.
The attack revolves around a DLL sideloading
makes extensive use of the Windows API to execute commands and launch processes.
staging the data in encrypted ZIP archives before upload.
information about specific registry keys
The scripts are encoded using different techniques,
The built-in Windows quser-command to show logged on users is also heavily used by them.
the team compromised a domain admin account and used it to laterally to multiple workstations and the DC.
The Granted Access level matches know indicators for Mimikatz
reads a string (or binary data) from its resource section
The dropper is executed by the user.
using Windows utilities like ping and tasklist.
invoking comsvcs.dll with rundll32.exe,
initiating a proxied
use of various obfuscation techniques in malware
which enables an HTTPS connection.
a 200+MB padded file
used by various actors to disable endpoint protection tools.
using a variety of encryption schemes and symmetric keys.
that pulls the Cobalt Strike payload from a fake JPG file.
application-level messages from the server to the client is sent as the body of an HTTP response
domain and local accounts
Valid Accounts: Domain Accounts
decrypts the payload
it download and execute yet another Python script
configured to proxy C2 traffic
uses a slightly modified AtomBombing technique that injects one of its stages into a Windows process
The threat actors managed to get access to the beachhead host after the successful execution of a lnk file within an ISO, which are usually distributed through email campaigns.
an encrypted payload
delivered via phishing email as an attachment
ProcDump was used to dump LSASS memory.
they added a new tool for remote access, Syncro, to their arsenal.
the threat actors then dropped SoftPerfect’s Network Scanner
encrypted with AES-256-CBC;
Microsoft research uncovers new Zerobot capabilities  Microsoft Security Blog
T1574.002
encoded PowerShell scripts
the corresponding APIs in the appropriate library.
compromised administrative [T1078.001] accounts
We’ve seen the adversary staging data on a remote system or on the local system.
three ways to connect to the C2 server
connect by sending a GET request to a URL from the configuration and provide a special cookie value
decrypting it using AES-256-CBC and a hardcoded key.
which is also embedded inside the CHM file
C:\Windows\system32\cmd.exe /c
the malware initiates a download, which delivers an executable
targets for phishing emails containing this type of decoy document.
executing it via a remote service.
Base64 encoded string, and in the other as a hexadecimal string
and process injection
and inject    shellcode,
the malware was distributed as email Word document attachments
encrypted payload from c2.
the presence of any installed anti-virus software on the machine.
modification of Registry Keys/Startup folder for persistence
schtasks /Create /TN test /SC MINUTE /MO 15 /TR
downloads three components from
Adversary installed custom backdoor as a service
The content of the MachineGuid registry value from the key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography
reg.exe ADD\n'HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server' /v\nfDenyTSConnections /t REG_DWORD /d 0 /f
often will search for directories on the network
API function
the encoded data in the BSS section
Current processes are checked
the embedded .NET injector
creates a task with schtasks for persistence
net user <username>
Keystrokes and windows monitoring
Exploit Public-Facing Application
MPRESS is a free packer.
injects itself into processes
The decrypted password
strings and the APIs used by
The actor in this campaign has used domain fronting, which is a technique which can use high reputation domains to conceal the Cobalt Strike command and control traffic.
When opened, the OneNote document instructed the recipient to "open" the document by double-clicking the button displayed in the OneNote document.
The threat actor used accounts with Delegated Administrator rights to access other O365 tenants
send phishing emails with malicious HTML attachments
The user account was possibly compromised on the Linux server by using credential stuffing
Retrieve information about registry keys
Log keystrokes
With the config decrypted
Disables the following Windows Defender features:Intrusion Prevention System\nIO AV Protection (does not scan downloaded files and attachments)\nRealtime monitoring\nScript scanning\nControlled folder access protection\nPUA protection\nScheduled scan
Query string containing system information before being sent to the C2.
the legitimate website will forward the traffic through the CDN to the original destination according to the host header.
Computer name
Storing the ransomware within a 7zip encrypted archive
Deletes some of its files used during operations as part of cleanup, including removing applications such as 7z.exe, tor.exe, ssh.exe
contains three identical executable files
The random (PsExec) service runs a rundll32.exe process without any arguments.
decrypt these database passwords
operators use Splashtop to move laterally and transfer malware between compromised hosts in the victim’s environment.
As attackers can quickly change spear phishing attachments
Victims will receive and interact with a decoy document containing a Google Drive link and a corresponding password instead of an archive download link embedded in the email.
computer name
include exfiltrating system information
The shellcode is then executed in a new thread.
the use of DLL sideloading for its arrival and execution technique.
Function and variable names are obfuscated
Appending a file signature header to all encrypted data,
RDP into the target host using reverse proxy
The batch file
the malicious document connects to the remote server and downloads the payload
It then attempts to connect to the C2 via TCP port 443
The threat actor was observed creating remote services in order to execute beacon DLL files
stub is a small part of code that implements the decompression (and decryption) of the originally packed file
Shellcode decryption loop
Lateral tool transfers have been used to move tools and files from one compromised system to another, including SMB and RDP.
Encoded PowerShell command
"cmd"  /c
Evasive Process
enumerate processes
Iranian GovernmentSponsored APT Actors Compromise Federal Network Deploy Crypto Miner Credential Harvester
The decrypted payload
Threat actors can use windows binaries and commands
most resources are written to disk encrypted,
the batch file
to identify where the Operative System is stored in the disk
obfuscated
calling API functions from this library
then deletes the registry key
exploitation of public-facing applications
operators attempted to capture cached credentials and then use them for lateral movement.
In order to establish persistence on the targeted host, the malware starts by saving a copy of itself in a new folder in the %APPDATA% directory
Username information
queries the Registry for ORACLE MICROS RES 3700 POS version, database passwords and other configuration data
The group uses DLL sideloading
systems injected the Conti DLL into memory
Both were designed to turn off antivirus and anti-malware software.
The organization used default configurations for hosts with Windows Server 2012 R2.
they also used tasklist
has been observed in multiple ISO files masquerading as legitimate software,
The Microsoft WinCrypt library is used for AES encryption and
a file downloaded from the internet,
unpacking the main module and
collect inside of the “Web Data” SQLite file
uses a temporary scheduled task to start after installation.
The DLL is used to create a malicious service
decrypted dba user password.
It uses the esxcli command to list all VM processes
propagating through brute force attacks on vulnerable devices with insecure configurations that use default or weak credentials
XOR-decrypts its contents,
process list
connects to a configured C2 server using HTTPS for communication.
conditional jumps that never run are included
deleting the “fb” folder to cover its paths and avoid detection
acquires handles for all running processes on the system, which results in either winlogon.exe or explorer.exe obtaining numerous process handles.
disable system defenses
spawned with PowerShell via Task Scheduler
targets victim’s login credentials
have used malware that deletes itself from the system
The communications module then downloads the main backdoor module,
Mimikatz being leveraged maliciously by threat actors in the following ways:\nCredential Loading\nMimikatz loads credentials from various sources such as Windows memory, Local Security Authority Subsystem Service (LSASS) process
checking if a file on the victim’s filesystem exists and gets the file’s attributes, collecting size and version information,
scanning selected IP addresses
plus the folder
the malware decrypts the payload with a delivered 64-byte RC4 key.
download multiple tools 
The method Invoke is used to inject a native PE into a remote process and InvokeVoid to call any exported function of the injected payload.
establish persistence by creating a registry key under \SOFTWARE\Microsoft\Windows\CurrentVersion\Run only if the victim’s machine name differs.
by writing to specific registry keys.
Downloading files and getting a screenshot
Almost every post-exploitation job was launched from an injected process.
Heavily obfuscated PowerShell script
the obfuscation technique for the dropped files being hex-encoding vs. string concatenation
Enigma Stealer Targets Cryptocurrency Industry with Fake Jobs
These credentials are generated and stored in the memory of the LSASS process
adds it to the HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run key
Web lnks with two shortcuts:
runs in a new process
cmd /c
The command to get specific files
The dropper bundle in the applications folder appears legitimate,
These messages used Microsoft OneNote attachments (.one) to execute a malicious HTA file
to decrypt the password stored
Each email has an HTML attachment.
similar screen captures
Capturing screenshots
RDP connections were established from the beachhead host to systems throughout the environment
HTTP communication between the Beacon and the Cobalt Strike server
has exploited web server vulnerabilities for initial access.
is typically executed via command line arguments
cmd /C
computer name
can capture screenshots
seeks out files with the following file extensions: .log, .vmdk, .vmem, .vswp and .vmsn.
Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder
The decrypted payload
send the decryption program
shellcode with RunPE code is used to perform the injection
user must click to download the malware
The data in the HTTP body is the same as the past variant,
Calling Local Windows RPC Servers from .NET
It copies the headers, maps the individual PE sections,  processes any relocations,  loads the PE’s imports, and then executes the PE from its internally specified entry point.
After this the adversary dumps the domain admin credentials from the memory of this machine, continues lateral moving through the network,
download a “.VBS” file
the threat actor accessing the wiki as users who would be considered “non-privileged”
The bytes of the encrypted section is a specific index on the byte map
these are encrypted and split inside the XML.
By extracting the syscalls, and executing them manually, the malware can use the API of the operating system, without a need of calling functions from the DLL.
If it fails, it sets in the registry
to register a scheduled task used to launch the ransomware payload.
reaching out to the server to obtain a further payload.
to download the second stage.
This function scans a specified path by finding all files within the given directory and its subdirectories.
conceal the utilization of potentially suspicious APIs (functions) from static detection
used for HTTP client requests
prompting the user to open the HTML attachment
can be configured to create a service for persistence.
Command Line Execution
base64-encoded PowerShell command.
passes the obfuscated string to a function that strips the arbitrary string and delivers the original string
configuring autorun entries,
this executable then downloads and executes additional payloads
exfiltrated to the attacker-controlled server through an HTTP POST request to the URL
spear phishing attachments for Initial Access
which is used for the first sideloading.
it then checks the amount of IPs found in the ARP table
creates the registry key
Clicking on the LNK file executes the batch file
malware is designed to steal sensitive information from victims' systems,
ROP-based attacks execute “RET” instructions without a prior “CALL” instruction, the running thread’s stack and the shadow stack values mismatch
use UltraVNC to download two LNK\nfiles
systeminfo
Decrypted payload 
injecting code
send commands.
DLL side-loading
The threat actor utilized open-source reverse proxy tools to expose local devices located behind a NAT or firewall, to the Internet.
has attempted to get users to launch malicious documents to deliver its payload.
After gaining initial access to an organization by exploiting a vulnerability with a public POC,
Decryptor has finished the decryption process
uploaded to the command-and-control (C&C) server,
an ISO file opener that mounts and opens the file with a simple double-click.
DLL has an encrypted payload embedded in it.
has been known to self-propagate via SMB.
This service executes a malicious binary (Cobalt Strike Cat payload) under “C:\Windows\Temp\svchost.exe” every time the victim device is started.
disable Microsoft Defender
then two batch scripts were dropped and run.
“intelligent brute forcing”
DLL that decodes and drops three files
executes the decrypted shellcode
Ransom Cartel Ransomware A Possible Connection With REvil
Exploitation of Remote Services
upon initiation of the WMI service
phishing emails have similar topics and pretend to come from some of the same entities
proxy tools depending on their intended use.
invokes the Windows API function DisableThreadLibraryCalls
This could cause the file to run when double-clicked instead of opening it with a PDF viewer.
The actors downloaded malware and multiple tools to the network, including PsExec, Mimikatz, and Ngrok.
the threat actor could have easily used a second domain administrator account
These credentials are used in a credential stuffing
employs a forged document linked to G7 to target various governments within the G20 forum.
local accounts.
and the built-in Windows user account  [T1078.001] to move laterally
usernames
stages collected data in a directory before exfiltration
The certutil.exe program downloads the WinRAR binary
to search for ones relating to security
remote monitoring and management (RMM) software
is injected only into processes running under WOW64.
most likely using credentials gathered by the previous LSASS access.
DISABLING ANTIVIRUS/MALWARE SOFTWARE USING ".BAT" FILES
In some cases, batch (.bat) scripts were created
used as a lure to entice the victim into opening the malicious file.
If the Process Hollowing method is used, a new svchost.exe process is created in a suspended state.
taking screenshots
It is encrypted using the AES algorithm
Decryption of the config buffer in the Forked Loader.
McAfee Defenders Blog NetWalker
The WMI component of the POSHSPY backdoor leverages a Filter to\nexecute the PowerShell component of the backdoor on a regular basis.
This process can be summarized as Exe -> Resources -> BMP with embedded data in pixels fetched
After the download, another button appeared, which, when clicked, executed the file.
proxy server
is protected with DNGuard, a commercial .NET packer.
Dark Web Profile MuddyWater APT Group
Once the encoded payload has been located
they will submit immediate tasks to the hosts in the domain through GPO
They used multiple malicious PDFs and MS Office documents during the campaign.
sideloads the DLL to the AutoIt interpreter process
they used yet another technique to dump LSASS on the beachhead host, this time using a built in Windows tool comsvcs.dll.
were able to be decrypted by leveraging the decryption script
Banking Trojan Techniques How Financially Motivated Malware Became Infrastructure
decryption function decrypts the URL pointing to the attacker-controlled server
and inject processes.
adding the HIDDEN file attribute
establishes persistence by creating an autostart service that allows it to run whenever the machine boots.
It was quite common to see scheduled tasks used to create persistence for the ransomware executable,
the initial loader/injector winutils.dll is protected with UPX-style packing
the malicious library is the same and serves to load and execute shellcode from a file that is stored under the same name as the DLL
File enumeration
fetch the next stage payload.
spear phishing attachments.
a BAT file (4.2) to be run on logon as another UI shell
it creates a one-time scheduled task.
This configuration file is encrypted using the just-described function and starts with the magic bytes 0xAF1324BC
 The local module utilizes the LookupPrivilegeValueW and AdjustTokenPrivileges that Windows API calls on its own process via GetCurrentProcess and OpenProcessToken to obtain SeDebugPrivilege privileges.
The PDF and executable files have numerous spaces before the file extension to hide it and allay suspicions.
Self-delete after sending data
The threat actor was observed creating remote services
after reaching the local DC, the attacker was able to gain a better lay of the land and observe the presence of the other two domains.
use this technique to inject themselves into other processes
drops the DLL
adding itself to the startup folder
after decrypting the frData member in
DLL for sideloading
tasklist
In addition, the sample generates a scheduled task with multiple triggers.
UAC BYPASS
using the API
process hollowing was used to inject a malicious PE file into the legitimate process called aspnet_compiler.exe.
to steal information from the compromised or targeted host
designed to steal sensitive information, including login data, cookies, and Facebook ad and business account information.
When decoded
listing directory and file information in the format\n D|-|<Date created> |<Date modified> |<folder or file name>
then sends the AES-encrypted system data.
This file is an obfuscated .NET file
domain fronting
cmd /C
KCP protocol
The script will then execute the downloaded file with Rundll32.exe
Enumerates files under Steam application directory
is unpacked
HTTP POST request (type 27 / data exfiltration).
uses Mimikatz to dump passwords.
A snippet of the RC4 key generation function
the adversary now armed with the valid account, was able to access a document stored in SharePoint Online, part of Microsoft Office 365.
Using Mimikatz and dumping of lsass,
GetSubDirectoryFileListRecursive function
the UPX packed sample
encoded payload
decrypt the MFT,
after a user opened an Excel document and enabled macros.
executes another BAT script
Additionally, the threat actor was observed attempting to dump the Local Security Authority Subsystem Service (LSASS) process
files dropped in the Windows startup folder are run
The attackers collect information from the local system for exfiltration purposes.
unpacks it with aPLib
threat actors using reverse proxy
Following HTTPS activity,
Remote access tools were used for command and control, such as Tactical RMM and Anydesk.
examples of the command line syntax used for the performance of this activity
cmd /C
encrypted archive containing the ransomware,
Additional data is gleaned via WMI queries
Base64 Decoded instructions in dropper
DLL sideloadingThis
Legitimate accounts obtained by the attackers can be used to ensure persistence in the compromised infrastructure.
WMI Filters\ndefine conditions that will trigger a Consumer, including system\nstartup, the execution of a program,
only uses one code obfuscation technique: API hashing.
Using valid accounts
executed when the victim opens the contents of the file
To limit the disk space used, images where fewer than 5% of the pixels differ from the most recently stored capture aren’t saved.
keylogging
The backdoor\nuses domain fronting to obfuscate its true C2 server
contains an embedded DLL
the threat actor must first decrypt them
is a .NET DLL library (compiled on April 29, 2020) imported when GDFInstall.exe is run
All data is then sent back to the attacker's C2
makes use of API GetTickCount / QueryPerformanceCounter
it searches the drives of compromised systems for interesting files
After hijacking the aforementioned drivers, the rootkit erases the DLL names associated with them from internal structures used to display device drivers.
comes with an embedded PE payload
Following the payload header, the malware expects blocks of\nencrypted data with 8-byte headers.
screen capture
ipconfig /all
create a legitimate looking folder to drop an illicit version of the System Configuration Utility msconfig.exe
domain fronting
records keystrokes.
icon files with encrypted data appended to the end of the files.
sample uses obfuscation
The keylogging utility was configured\nto capture and record keystrokes to C:\ProgramData\psh\System32Log.txt.
take screenshots during, online conversations.
Injected Process Name
the decryptor to clean up their environment.
use HTTP/HTTPS for C2 connections
This process is further camouflaged by changing its associated executable filename to one of svchost.exe or dllhost.exe in the same kernel structure.
to download a next stage EXE payload using cURL
Logfiles on the Linux-system show traces which can be attributed to a credential stuffing or password spraying attack.
This executable binary insecurely downloads and executes additional payloads from the Internet.
cmd.exe /C whoami
Encoded Royal Road payload
The emails were sent through various compromised email accounts, propagating additional malicious xls files
logging keystrokes via polling and application hooks
RDP into the target host
Downloading and running further executables
uses byte remapping to ensure that the shellcode cannot be easily decrypted without the correct byte map
the actors using Mimikatz during their operations.
encrypted URLs contained in the malware itself.
the user clicked on the ISO file, which created a new virtual hard drive disk
Register a new service
launched on every startup by rundll32.exe
the adversary gained credentials in the network
Disabling Windows Defender notifications, Task Manager and Command Prompt
This is sent to the server along with the computer’s name
One of the main initial access vector is exploitation of publicly exposed web services.
then proceeds to gather basic system information, including username, computer name, and OS version, which it then encrypts using AES-256-CBC and the generated,
Registry keys changed
The default configuration allows unprivileged users to query group membership of local administrator groups
recursively removes the implementation of Windows Defender IOfficeAntiVirus
the following URLs are hard coded, and obfuscated
Injecting pc.dll into LSASS as a Security Package
API hashing
which were started via their interactive RDP session
the keylogging utility
used HTTPS reverse proxies to redirect C2 traffic.
the command "net stop Cisco AMP".
created a persistence mechanism for NGROK by adding\nVirtualHost.vbs to the WindNT value under the current users Run\nregistry key.
there is a custom AntivirusCheck class, which can check running processes against a hardcoded list of XOR-encrypted executable filenames from known security products: 360 Total Security, Avast, Avira, AVG, Bitdefender, ESET, Jiangmin Technology Antivirus, Kingsoft, McAfee, Micropoint, Norton, Rising Antivirus, and Trend Micro.
performs the following actions to alter Windows Defender settings
It is unpacked
After decrypting and decompressing the payload
The red team used and identified several standard user accounts with administrative access from a Windows Server 2012 R2 SharePoint server.
.NET packer known as CyaX
running processes
To prevent being detected, the attackers end processes and services related to security and antivirus software.
extract shellcode
This was double base64 encoded.
Attempts to delete malicious batch files.
HTTP HEAD request
web application vulnerabilities
This attacker utilized an additional keylogging utility
can modify registry entries
various injections across hosts
Once the master key is decrypted,
delete files.
computer name
T1110
proxy/tunneling utilities (HTran, LCX, EarthWorm
T1053.005
Reconfigures Windows Defender to exclude the user profile path and the entire system drive from scanning.
using a batch file named find.bat.
threat actors using this tool are very quick to update their lures and find ways to entice their victims into installing the malicious remote control software.
located in a hidden folder
a check using pgrep for Activity Monitor processes
The decryption key
AnyDesk was used to move laterally between a workstation and a backup server
ARP table
Network adapter IP addresses\nMAC address of one of the adapters
is decrypted
Network adapter details are pulled via GetAdaptersAddresses
not see them in the imported function list, and they not even be part of the strings in the sample.
writes the path of the executable file, “_upyqta2_Ji7.exe”, to the class’s registry key “HKEY_CURRENT_USER\software\Classes\ms-settings\shell\open\command”
locate high value assets in order to exfiltrate data
the user the threat actor used to RDP
executes a batch file
The Decryption shellcode
They issued remote commands using WMIC to conduct discovery, as well as distribute and execute Cobalt Strike beacons.
c:\windows\temp\procdump64.exe -accepteula -ma lsass.exe
used to decode the body
the data will be published on our TOR darknet sites.
APC injections
used to retrieve a payload package containing the second stage PowerShell and two shellcode buffers
This can be anything from file and directory-listings, configuration files, manuals, email stores in the guise of OST- and PST-files, file shares with intellectual property (IP), and data scraped from memory.
detect memory dumps of the lsass process
Drive information retrieval
using PowerShell.
the batch file in Figure 7, which Sandals creates on remote systems to launch
have used various encryption algorithms in their droppers to hide strings and payloads
Upon unpacking a sample
collect information about the computer name and OS version and whether it is 32-bit or 64-bit
Parse all installed application in the compromised host by querying 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall' registry
Returns the current user’s name
Then it runs the following to attempt to clear file system cache memory:\n%windir%\system32\rundll32.exe
with the keylogger component of the driver (described in the next section) by reading data from the \\.\pipe\namedpipe_keymousespy_english named pipe.
The adversary copied those tools over SMB from compromised system to compromised system wherever they needed these tools.
executes a file using ShellExecute
We have also found that each sideloader DLL has its own pair of executable and byte map,
Once the malicious DLL is sideloaded, it will drop the legitimate EXE file and the malicious DLL file, which are embedded in the resource section of the DLL file.
The decryption function is shown below, the decryption function can be represented as the following pseudocode:
malware that communicates over the MQTT protocol.
Injection type: Current process (1) or in the new process
to download and execute a payload
The actors added an exclusion rule to Windows Defender.
cyber actors also used on-premises Identity and Access Management (IdAM) and federation services in hybrid cloud environments in order to pivot to cloud resources.
will need to resolve these APIs dynamically to interact with the Windows operating system
which is vulnerable to a DLL side-loading vulnerability, and loads a file
or delete files
to enable multiple Remote Desktop\nconnection sessions
looks for
were observed using the 7-Zip utility to unzip imported tools and malware files onto the victim device.
whoami  /groups
This was achieved by transferring a Cobalt Strike DLL over SMB
collect information about the IP and MAC addresses of the infected machine
File deletion functions
a RAR archive
Adds registry run keys to achieve persistence.
employ the remote template injection method to retrieve the next stage of the malware from the TA’s Command-and-Control (C&C) server.
It also drops and installs
injected and executed within the normal Windows process called mstsc.exe.
disabling Windows Defender
the original encoded MBR
used to proxy RDP connections and connect to another computer.
:\Windows\system32\cmd.exe /C
reg.exe: reg  add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v "fDenyTSConnections" /t REG_DWORD /d 0 /
Payload\nObfuscation
attempts to clear file system cache memory, and self-deletes
RDP sessions
This enables the document to fetch the .dotm file from the remote server required for further actions
The archives often include a JavaScript (.js) file
executable that dropped a legitimate WD Discovery app to side-load the malicious WDLocal.dll
First-stage legitimate executable for DLL sideloading
decrypted
used other victim networks to proxy their C2\ninstructions, likely to minimize the risk of detection and blend in\nwith normal network traffic.
DeleteFile
cmd.exe /c
that embeds the Crypter with the payload.
All communications between the server are encrypted with RC4
irrelevant code
these are the same commands as observed in the ".bat" files:
delivered to the victim, commonly through a phishing mail
DLLs with the names ualapi.dll and ncobjapi.dll being sideloaded
Windows API functions
ipconfig /all
Exfiltrate screenshots
crawl the filesystem
Windows Batch script
traces of RDP (Remote Desktop Protocol) connections were discovered on multiple compromised hosts utilized for lateral movement
It installs itself by creating aservice called InstallSvc which will trigger “C:\programdata\netsky\netsky.exe online”.
Once decoded, the loader's execution jumps to the beginning of the DLL
to establishing a RDP session, including the ability to navigate using a graphical environment and easily move laterally once the necessary access has been granted
It calls OpenProcess on lsass.exe with access flag set to VM_READ, and looks for the modules wdigest.dll and lsasrv.dll loaded in the lsass.exe process.
sending basic host info to the C2
attackers was to establish a Remote Desktop session
TcpConnector/TcpBindConnector
T1078
threat actors proceeded to run the net commands
the threat actor deployed several Atera/Splashtop remote access tools across the environment as an alternative means of access to the environment
the ‘Powershell.exe’ process initiated the WMI requests.
contain an encoded PowerShell,
the payload of the malware can be part of the loader’s file
executed using ShellExecute with the following command line:
cmd /c
embeds legitimate DLLs using the SmartAssembly feature 
C:\Windows\System32\rundll32.exe
This campaign began with thread hijacked emails which contained HTML attachments.
The current username home folder
a process injection in one of the svchost processes
inject shellcode into the process
embedded payloads of one of the IronPython scripts.
Domain fronting can be achieved with a redirect between the malicious server and the target.
embedded inside as a base64 encoded buffer
command pulls down a Visual Basic script, drops it into the C:\Windows\Tasks folder, and executes it.
0x10000013data for C&C server (execution logs, stolen data, …)
Using the remote admin tools
attacker dump the LSASS process using Task\nManager to a file named lsass.DMP, and later, zip the dump into two\nfiles named lsass.zip and lsass2.zip located in the\nC:\ProgramData\psh\ directory.
uses HTTPS to communicate with Google Drive.
to enable Remote Desktop sessions (RDP) using reg.exe.
the Windows Registry or NTFS Extended Attributes to hide their data,
Application-level protocol
default or weak credentials
Drop a file named ossutilconfig in the %USERPROFILE% directory
collects specific system information
decrypted and decoded version
"C:\Windows\System32\schtasks.exe" /create /sc minute /mo 15 /tn
file downloads relating to tooling/scripts.
The use of WMIC was leveraged by a batch file
abusing API calls in the Operating System.
flood a remote DNS server with false traffic.
In reflective PE injection, the PE file is parsed and its sections are reconstructed in the target process’s memory.
We observed the use of Mimikatz on this system and saw the hashes of the logged in domain admin account going
the sideloaded DLL),
domain name, Hostname and OS Version
This module is an obfuscated shellcode.
to grab the encoded and encrypted master key
In addition to file encryption and obfuscation,
modules spread the malware laterally across a network by abusing the SMB Protocol.
used various RATs that use TCP for C&C communications
creates a group policy
which in turn injects the payload(s) into its own or a remote process.
searched files on the server, and found plaintext credentials
Encrypted payloads will also obfuscate useful strings from static analysis.
upload/download file
trying to dump LSASS process.
Decryption exclusion list
to execute various dropped tools or beacons on the endpoint,
Command Line Arguments
Identify a domain that uses the same CDN to ensure that the traffic will be forwarded to the correct resource.
T1074.001
only decrypts the first matching\nblock
the ransomware drops a batch file
The phishing attachment was submitted to the target in a response to an ongoing conversation
As NetSupport Manager is a legitimate tool that has a long history of development, it is highly attractive to attackers as it can be relied on to work ‘out of the box’.
0x10000025get handle of the process with specified PID
When the executable is run, the DLL next to it is loaded.
the process imbedded itself into wermgr.exe, the Windows Error Reporting Manager (Process ID 6660).
It is obfuscated with a protector resembling the open source OLLVM obfuscator.
the configuration file encrypted.
GET request with C2 server
finds the API functions it needs
